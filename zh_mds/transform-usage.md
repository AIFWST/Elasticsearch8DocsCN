

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Roll up or
transform your data](data-rollup-transform.md) ›[Transforming
data](transforms.md)

[« Set up transforms](transform-setup.md) [Generating alerts for transforms
»](transform-alerts.md)

## 何时使用转换

Elasticsearch 聚合是一项强大而灵活的功能，使您能够汇总和检索有关数据的复杂见解。您可以总结繁忙的网站上每天的Web请求数等复杂内容，按地理位置和浏览器类型细分。但是，如果您使用相同的数据集来尝试计算访问者网络会话平均持续时间的单个数字这样简单的东西，则可能会很快耗尽内存。

为什么会这样？Web 会话持续时间是行为属性未保存在任何一个日志记录上的一个示例;它必须通过在我们的博客中找到每个会话的第一个和最后一个记录来得出。这种派生需要一些复杂的查询表达式和大量内存来连接所有数据点。如果您有一个正在进行的后台进程，将一个索引中的相关事件融合到另一个索引中以实体为中心的摘要中，您将获得更有用的联合图片。此新索引有时称为a_data frame_。

在以下情况下，您可能需要考虑使用转换而不是聚合：

* 您需要一个完整的_feature index_，而不是前 N 个项目集。

在机器学习中，您通常需要一组完整的行为特征，而不仅仅是前 N 个。例如，如果您预测客户流失率，则可以查看上周的网站访问次数、销售总数或发送的电子邮件数量等功能。Elastic Stack 机器学习功能基于此多维特征空间创建模型，因此它们受益于转换创建的完整特征索引。

当您尝试跨聚合或多个聚合的结果进行搜索时，此方案也适用。聚合结果可以排序或筛选，但排序和按存储桶选择器筛选受返回的最大存储桶数的限制存在限制。如果要搜索所有聚合结果，则需要创建完整的数据框。如果需要按多个字段对聚合结果进行排序或筛选，则转换特别有用。

* 需要按管道聚合对聚合结果进行排序。

管道聚合不能用于排序。从技术上讲，这是因为管道聚合在所有其他聚合已完成之后的reduce阶段运行。如果创建转换，则可以有效地对数据执行多次传递。

* 您希望创建汇总表来优化查询。

例如，如果您有一个由大量用户访问的高级仪表板，并且它对大型数据集使用复杂的聚合，则创建转换以缓存结果可能更有效。因此，每个用户都不需要运行聚合查询。

[« Set up transforms](transform-setup.md) [Generating alerts for transforms
»](transform-alerts.md)
