

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Release
notes](es-release-notes.md)

[« Elasticsearch version 8.6.1](release-notes-8.6.1.md) [Elasticsearch
version 8.5.3 »](release-notes-8.5.3.md)

## 弹性搜索版本8.6.0

另请参阅 8.6 中的重大更改。

### 已知问题

* 使用 'settings.json' 文件配置 Elasticsearch 的编排器可能会在主选举期间遇到死锁(问题：#92812)

要解决死锁，请删除"settings.json"文件并重新启动受影响的节点。

* 当数组中的最后一个元素被过滤掉(例如使用"_source_includes")时解析请求失败。这是由于杰克逊解析器中的一个错误。在 Elasticsearch 8.6.1 中修复 (#91456) * 当使用摄取附件处理器时，Tika 与 log4j 2.18.0 及更高版本(在 Elasticsearch 8.4.0 中引入)的交互会导致过多的日志记录。此日志记录过多，可能导致群集不稳定，直至群集不可用且必须重新启动节点。(问题：#91964)。此问题已在 Elasticsearch 8.7.0 (#93878) 中修复

要解决此问题，请升级到 8.7.0 或更高版本。

* 分片重新平衡可能会暂时使集群失去平衡

从 8.6.0 开始，默认的分片重新平衡算法将计算最终的期望余额，然后进行分片移动以协调集群的当前状态与期望状态。但是，分片移动发生的顺序可能会偏向某些节点，从而导致集群在协调过程中暂时变得不平衡。与往常一样，一旦节点达到磁盘水印，它将不接受任何其他分片，但这种倾斜可能会导致节点在正常操作中比预期更频繁地到达其磁盘水印。对帐过程完成后，群集将再次平衡。

要避免此问题，请升级到 8.8.0 或更高版本。

### 错误修正

Aggregations

    

* 地理边界聚合拒绝子聚合 #91073(问题：#91072)

Allocation

    

* 当对所需余额中存在的节点执行取消关联死节点时，避免 NPE #91659 * 在假设重新启动之前检查"节点关闭元数据"类型 #90807

Authentication

    

* 修复 JWK 重新加载的连接请求超时的时间单位 #92080 * 使用 DN 提高角色映射的性能 #92074 * 提高"JwkSet"重新加载的健壮性 #92081 * 支持版本 6.7 之前存储的身份验证标头 #92221

Authorization

    

* 使向 REST 响应添加身份验证信息更可靠 #92168 * 安全删除日期数学特殊处理 #91047

集群协调

    

* 修复了"传输主节点操作"不必要地持有 CS 引用 #90724(问题：#89220) * 在出版物 #92259 中包含上次提交的数据(问题：#90158) * 不安全的引导内存优化 #92493

EQL

    

* EQL 序列：支持多值联接 #89965

Graph

    

* 修复了响应 #91006 中图形 API 超时字段的潜在问题

Health

    

* NO_VALID_SHARD_COPY诊断时不考虑未分配的原因 #92416 * 修复了评估非数据节点的磁盘运行状况时的 NPE #92643 * 在"shards_availability"指示器的短 URL 中使用 https #92310

索引接口

    

* 更新组件模板时触发索引设置提供程序 #91615(问题：#91592)

Infra/Core

    

* 检查 Metadata.isGlobalStateEquals 中的保留状态 #92124 * 数据流不可用的异常元数据 #91461 * 修复附加空"BytesRefArray"的"字节引用数组" #91364 * 修复具有单个名称或模式的请求的索引表达式选项 #91231 * 在 log4j 中强制初始化 Unbox#92377(问题：#91964) * 在基于文件的设置中，等到安全索引准备好进行角色映射 #92173(问题：#91939) * 索引表达式排除项永远不会触发"未找到" #90902 * 更新错误主状态执行程序 #90346 内部的状态(问题：#90337)

Infra/Scripting

    

* 修复了以 d/f #91501 结尾的十六进制文字编译的问题(问题：#88614)

采集节点

    

* 修复了"EnrichCoordinatorProxyAction"中的争用条件，该条件可能会使项目卡在其队列中 #90688(问题：#90598)

机器学习

    

* 创建 DF 分析目标索引时复制更多设置 #91546 (问题： #89795) * 修复_No statistics_错误消息 #2410 * 修复了_No计数available_错误消息 #2414 * 防止输入序列对于问答模型来说太长 #91924 * 提高生成前关闭文件的性能 #2424 * 对数据馈送执行前期权限验证时跳过远程群集 #91895(问题： #87832) * 支持数据框分析"analyzed_fields"中带逗号的字段 #91710(问题：#72541)* 验证规则筛选器是否存在于打开的异常情况检测 API #92207

Mapping

    

* 解析映射和文档时合并字段名称验证 #91328 * 修复了在术语聚合中处理空键大小写的问题 #90822

Monitoring

    

* 修复日志存储负载平均(xpack 案例)#90494 * 堆栈监控] 更新 ES 模块映射 [#90649

Network

    

* 清理分块时异常 XContent #92024 * 修复分块 API 向 HEAD 请求发送错误响应的问题 #92042(问题：#92032) * 关闭 #92465 时拒绝连接尝试

SQL

    

* 修复了不跟踪总点击时日志记录的 NPE #92425

Search

    

* 根据评分函数允许不同的衰减值 #91195 (问题： #78887) * 修复 DFS 分析的计时错误 #92421

Snapshot/Restore

    

* 简化和优化非缓存存储库实例的"存储库数据"重复数据删除 #91851(问题：#89952)

Store

    

* 修复 numOpenOutputs 和 modCount in ByteSizeCachingDirectory #92440 (问题： #92434)

Transform

    

* 执行预先权限验证时跳过远程群集 #91788

矢量搜索

    

* 使"knn"搜索请求完全可取消 #90612

###Deprecations

Allocation

    

* 弃用 /_cluster/reroute 响应中的状态字段 #90399 * 确保余额阈值至少为 1 #92100

采集节点

    

* 弃用_remove_binary_摄取附件处理器 #90460 的默认值 false。

Mapping

    

* 弃用静默忽略元数据字段定义中的类型、字段、copy_to和提升 #90989(问题：#35389)

###Enhancements

Allocation

    

* 在滚动更新期间清除先前写入索引中的预测写入负载和分片大小 #91590 * 滚动更新期间预测平均分片大小 #91561 * 预测滚动更新期间的写入负载 #91425 * 改进分片平衡 #91603 * 引入所需余额分配器 #91343 * 限制分片重新定位重试次数 #90296 * 预验证节点删除 API #88952 * 设置默认"cluster.routing.allocation.balance.disk_usage" #91951 * 在数据流期间将写入负载存储在"索引元数据"中翻转 #91019 * 更新默认的"cluster.routing.allocation.balance.disk_usage"#92065 * "DesiredBalance："通过 _internal/desired_balance 公开它 #91038(问题：#90583)

Authorization

    

* 队列] 为"kibana_system"添加了日志elastic_agent* 读取权限 [#91701

CRUD

    

* 跟踪平均分片写入负载 #90768(问题：#90102)

Geo

    

* 笛卡尔点和形状的质心聚合 #89216(问题：#90156) * 改进 H3#hexRing 逻辑并添加 H3#areNeighborCells 方法 #91140 * 将空间实用程序移动到地理库 #88088(问题：#86607) * 减少 H3#geoToH3 中的对象分配数量并加快计算速度 #91492 * 支持点和形状上的"cartesian_bounds"聚合 #91298(问题：#90157)

ILM+SLM

    

* ILM：获取策略支持通配符名称 #89238

Infra/Core

    

* 将 APM 全局标签作为附加设置处理 #91438(问题：#91278) * 改进表达式中的日期数学排除项 #90298 * 引入一个阶段以在常量字符串上使用 String.equals，而不是 def equality #91362(问题：#91235) * 古代索引的更多可操作错误 #91243 * 运算符/索引模板 #90143 * 运算符/摄取 #89735 * 传输线程和"_hot_threads" #90482(问题：#90334) * 将 XContent 升级到 Jackson 2.14.0 并启用快速双解析器 #90553

Infra/Plugins

    

* 加载稳定插件时创建占位符插件 #90870 * 稳定插件示例 #90805 * 在插件描述符 #90835 中将"扩展插件"、"HasNativeController"和"moduleName"设为可选 * 将"命名组件"名称参数重命名为值 #91306

Infra/Scripting

    

* 对无痛的空接收器使用显式空检查，而不是 NPE #91347(问题：#91236)

机器学习

    

* 为常用项目添加筛选参数 #91137 * 将正则表达式添加到"categorize_text"聚合的输出中 #90723 * 添加按"change_point"数值对存储桶进行筛选和排序的功能 #91299 * 添加 API 以更新训练的模型部署"number_of_allocations" #90728 * 别名时间戳以@timestamp异常检测结果索引 #90812 * 允许"model_aliases"与 Pytorch 训练模型一起使用 #91296 * 允许在文件结构查找器中覆盖时间戳字段为空#90764 * 每天审核一条消息，数据馈送没有看到任何数据 #91774 * 低优先级训练模型部署 #91234(问题：#91024)* 提供有关异常分数因素的其他信息 #90675

Mapping

    

* 记录未映射字段时不要创建 IndexCaps 对象 #90806(问题：#90796) * 聚合指标双重添加最大最小验证 #90381

Recovery

    

* 启动分片后删除调整索引大小设置 #90391(问题：#90127)

Rollup

    

* 测试下采样运行时字段和安全性 #90593

Search

    

* 将有限偏移枚举添加到有限偏移令牌 #86110(问题：#86109) * 为 dfs 阶段 #90536 添加分析和文档(问题：#89713) * 使用映射哈希批量合并字段上限响应 #86323 * 解析查询时增强嵌套深度跟踪 #90425 * 公开有关搜索使用情况的遥测数据 #91528 * 在存档索引中使用嵌套映射时返回文档 #90585(问题：#90523) * 对 IP 范围查询使用"索引或文档值"查询 #90303(问题： #83658)

Snapshot/Restore

    

* 将快照热池最大大小增加到 10 #90282(问题：#89608)* 将快照速度与节点带宽设置绑定 #91021(问题：#57023)

Store

    

* 允许插件包装由"索引模块"创建的 Lucene 目录 #91556

TLS

    

* 将证书开始/到期日期添加到 SSL 诊断消息 #89461

TSDB

    

* 从动态映射模板生成 _index.routeting_path_ #90552(问题：#90528) * 支持合成"_source"中的格式错误的数字 #90428 * 支持"_doc_count"字段的合成"_source" #91465 * 合成_source：在许多情况下支持"字段"#89950 * 合成"_source"："ignore_malformed"表示"ip"#90038 * 合成"_source"：支持"通配符"字段 #90196

Transform

    

* 添加运行状况部分以转换统计信息 #90760 * 在转换聚合中支持"aggregate_metric_double"字段类型 #91045

矢量搜索

    

* 为 knn 矢量查询添加分析信息 #90200

### 新功能

Distributed

    

* 添加带有功能标志和设置的"索引"和"搜索"节点角色 #90993

EQL

    

* EQL 样本 #91312

Health

    

* 对"RestGetHealthAction"使用分块编码 #91515(问题：#90223) * HealthAPI] 使用"RestCancellableNodeClient"基础结构 [#91587

机器学习

    

* 使"categorize_text"聚合 GA #88600

矢量搜索

    

* 添加对字节大小向量的字段数据和脚本支持 #91184 * 添加对索引字节大小的 knn 向量的支持 #90774

###Regressions

Infra/Core

    

* 恢复"从快照服务中删除'不可变的OpenMap'" #90287

###Upgrades

Infra/Logging

    

* 升级到 log4j 2.19.0 #90589(问题：#90584)

Network

    

* 升级到 Netty 4.1.82.Final #90604 * 升级到 Netty 4.1.84 #91271

Snapshot/Restore

    

* 将 GCS SDK 升级到 2.13.1 #92327

[« Elasticsearch version 8.6.1](release-notes-8.6.1.md) [Elasticsearch
version 8.5.3 »](release-notes-8.5.3.md)
