

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Release
notes](es-release-notes.md)

[« Elasticsearch version 8.1.1](release-notes-8.1.1.md) [Elasticsearch
version 8.0.1 »](release-notes-8.0.1.md)

## 弹性搜索版本8.1.0

另请参阅 8.1 中的重大更改。

### 已知问题

* 当数组中的最后一个元素被过滤掉(例如使用"_source_includes")时解析请求失败。这是由于杰克逊解析器中的一个错误。在 Elasticsearch 8.6.1 中修复 (#91456)

### 重大变更

Geo

    

* 字段 API 应返回规范化几何 #80649(问题：#79232、#63739)

### 错误修正

Aggregations

    

* 重新启用"布尔术语IT"#83421(问题：#83351) * 向后兼容版本 7.17.0 #83715 * IP 前缀存储桶减少 #83637 * 将浮点和半浮点值减少到其存储的精度 #83213

Allocation

    

* 修复"updateMinNode"条件 #80403(问题：#41194) * 进行"*.路由.分配.*"基于列表的设置 #80420(问题：#77773) * 允许对泛洪阶段阻止的索引进行元数据更新 #81781 * 群集恢复后重新路由 #82856(问题：#82456)

Authorization

    

* 创建 API 密钥时捕获匿名角色 #81427(问题：#81024)* 扩展队列服务器服务帐户权限 #82600

Autoscaling

    

* 修复了关注者数据流的自动缩放 #83302(问题：#82857)

Client

    

* 修复了 REST 客户端 #83568 中的自我抑制问题(问题：#42223)

Distributed

    

* GCE 发现] 正确处理具有 500 个或更多实例的大型区域 [#83785(问题：#83783)

Engine

    

* 分片失败时分叉到"写入"线程 #84606(问题：#84602)

Geo

    

* 当网格图块跨越日期变更线时正确处理边界 #83348(问题：#83299) * 如果"几何规范化器"无法计算签名区域，则不应失败 #84051(问题：#83946)

ILM+SLM

    

* 修复"策略步骤注册表"的"缓存步骤"空处理 #84588

索引接口

    

* 允许删除未引用的可组合数据流模板 #84376(问题：#84171、#84188) * 简化并加快"执行器选择器"#83514(问题：#82450)

Infra/Core

    

* 始终重新运行遇到错误的功能迁移 #83918(问题：#83917) * 在线程上下文存储中复制"trace.id" #83218 * 在"结果重复数据删除器"中保留上下文 #84038(问题：#84036) * 注册名为 xcontent 对象的"系统索引迁移任务"#84192(问题：#84115) * 如果"_meta"为空，则更新系统索引映射 #83896(问题：#83890)

基础设施/休息接口

    

* 不允许内容类型 #83448 上的安全列表媒体类型

Infra/Scripting

    

* 修复脚本引擎创建时重复的允许列表 #82820(问题：#82778) * 修复脚本字段 API 的双精度和关键字运行时字段中的管道 API #83392

Ingest

    

* 修复滚动升级期间启动的"GeoIpDownloader"问题 #84000 * 第一次匹配后短路日期模式 #83764

机器学习

    

* 允许在可以垂直缩放时自动缩放工作 #84242(问题：#84198) * 正确捕获 ML 使用情况中"inference.ingest_processors"的最小统计信息 #82352 * 如果进程崩溃，排队的推理请求失败并有原因 #81584 * 修复标点符号周围的 NLP 标记化"never_split"处理 #82982 * 修复"零镜头分类配置"更新混合字段 #82848 * 修复初始缩放从 0->1 缩放可能缩放过高的错误 #84244 * 修复进程关机后提交的问题辅助角色服务 #83645(问题：#83633) * 修复了"categorize_text"参数验证与解析顺序无关的问题 #82628(问题：#82629) * 记录每个节点的节点关闭开始时间 #84355 * 为快照升级参数注册命名的 X 内容解析器 #84420(问题：#84419) * 在重新定位期间重试异常检测作业恢复 #83456 * 如果未找到用于语言标识的有效文本，则返回"zxx"作为"lang_ident_model_1"#82746(问题： #81933) * 文本结构查找器大写字母不包括 1000 个字符的行模式 #84236(问题：#83434) * 验证模型部署上的词汇 #81548(问题：#81470) * 等待模型进程停止停止部署 #83644

Mapping

    

* 为"search_as_you_type"字段添加对子字段的支持 #82430(问题：#56326) * 更好的异常消息"映射解析器.parse"#80696 * 完成字段支持多个完成多字段 #83595(问题：#83534)

Network

    

* 在代理失败时抛出"NoSeedNodeLeftException"#80961(问题：#80898)

Packaging

    

* 将"log4j-slf4j-impl"添加到"存储库-azure"#83661(问题：#83652) * 在 postinst #84224 中升级密钥库后重新启动 ES(问题：#82433)

Recovery

    

* 将缺少的"indices.recovery.internal_action_retry_timeout"添加到设置列表中 #83354 * 将缺少的最大超额分配因子添加到(动态)设置列表中 #83350

SQL

    

* 修复空结果集的 txt 格式 #83376

Search

    

* 避免在获取阶段急切加载"存储字段读取器"#83693(问题：#82777) * 在字段获取阶段不需要时不要反序列化文档 #84184 * 当没有匹配的索引时返回有效的 PIT #83424

Security

    

* 添加 API 密钥角色描述符的验证 #82049(问题：#67311)

Snapshot/Restore

    

* 调整 aarch64 架构的 'LinuxFileSystemNatives.allocatedSizeInBytes' #81376 (问题： #80437， #81362) * 区分"缺少存储库"和"缺少存储库插件" #82457(问题： #81758) * 修复"DirectBlobContainerIndexInput"克隆方法 #84341(问题：#84238) * 将获取快照序列化移动到管理池 #83215 * 在"快照删除侦听器"中保留上下文 #84089(问题：#84036)

TSDB

    

* 修复时间序列时间戳元缺失 #80695

Transform

    

* 修复转换版本检查中的 NPE #81756 * 修复转换停止处理存储桶的情况 #82852 * 防止由于线程池限制而停止转换 #81912(问题：#81796)

Watcher

    

* 允许监视定义中的空类型数组 #83524(问题：#83235)

###Deprecations

CRUD

    

* 批量操作 JSON 必须格式正确 #78876(问题：#43774)

集群协调

    

* 删除最后几次提及的禅宗发现 #80410

Search

    

* 弃用"index.query.bool.max_clause_count"节点设置 #81525(问题：#46433)

SQL

    

* 弃用"index_include_frozen"请求参数 #83943(问题：#81939)

###Enhancements

Aggregations

    

* 为 IPv4 和 IPv6 子网添加聚合器 #82410 * 当我们检测到类型不匹配时，尽早使分片失败 #79869(问题：#72276) * 优化"significant_text"聚合，仅解析"_source"中所需的字段 #79651

Allocation

    

* 识别"SameShardAllocDec"消息 #82890 (问题： #80767) * 使"分配服务#adaptAutoExpandReplicas"更快 #83092 * 加快同一主机检查 #80767

Analysis

    

*将日语完成过滤器公开给黑路分析插件#81858

Authentication

    

* 为所有身份验证方案启用"run_as" #79809 * 在"_authentication"响应中返回 API 密钥名称 #78946(问题：#70306)

Authorization

    

* 当请求的索引都是具体名称时，避免加载授权索引 #81237 * 优化"matchAll"查询的 DLS 位集构建 #81030(问题：#80904)

集群协调

    

* 向慢速群集状态警告消息添加详细信息 #83221 * 批处理索引设置更新请求 #82896(问题：#79866) * 改进节点加入任务描述 #80090 * 使"对等查找器"日志消息更快乐 #83222 * 元数据的更紧凑序列化 #82608(问题：#77466) * 分页持久化群集状态 #78875 * 将详细增加超时减少到 3 分钟 #81118 * 对出版物使用网络回收器 #80650 (问题： #80111)

数据流

    

* 自动创建数据流时延迟重新路由 #82412(问题：#82159)

ILM+SLM

    

* 在 ILM 解释输出 #81273 中公开索引年龄(问题：#64429)

索引接口

    

* 批量自动创建索引群集状态更新 #82159 * 在获取索引 API #83083 中公开 _features_ 选项(问题：#82948) * 向"_stats"API 公开索引运行状况和状态 #81954(问题：#80413) * 强制合并 REST API 支持"wait_for_completion" #80463(问题：#80129、#80129)

基础设施/断路器

    

* 允许动态更改"use_real_memory"设置 #78288(问题：#77324)

Infra/Core

    

* 使用"VarHandles"进行数字转换 #80367(问题：#78823) * 在"ByteUtils"中使用"VarHandles" #80442(问题：#78823) * "FilterPathBasedFilter"支持将字段名称与点 #83178 匹配(问题：#83148、#83152)

基础设施/休息接口

    

* 允许自定义内容类型验证 #80906(问题：#80482) * 更新 YAML REST 测试以检查所有响应上的产品标题 #83290

Infra/Scripting

    

* 添加 _$_ 语法作为 Painless #80518 中 _field_ 的快捷方式 * 添加"BinaryDocValuesField"以替换"BytesRef""(ScriptDocValues)"#79760 * 为脚本字段 API 添加地理点字段 API #81395 * 将日期字段添加到脚本字段 API #81272 * 将半浮点映射添加到脚本字段 API #82294 * 将缩放浮点数添加到脚本字段 API #82275 * 为脚本字段 API 添加对"GeoShape"的支持 API API #81617 * IP 映射类型的字段 API #81396 * 字段 API对于字节、双精度、浮点数、整数、长整型、短型 #81126(问题：#79105) * 平展映射类型的字段 API #82590 * 用于 x-pack 'constant_keyword' 的字段 API #82292 * 适用于 x 包版本、文档版本、序列号、mumur3 的字段 API #81476 * 改进了对 joda 日期时间的支持 Java 日期时间 在无痛 #83099 中 * 关键字字段 API 支持 #81266 * 使通配符可从脚本字段 API 访问 #82763 * 序号字段数据管道 #80970(问题： #79105) * 在字段 API 中支持布尔字段 #80043(问题：#79105)* 时序编译和缓存逐出指标 #79078(问题：#62899)

Infra/Settings

    

* 优化"元数据更新设置服务"中的重复代码块 #82048

机器学习

    

* 添加在推理时更新截断选项的功能 #80267 * 向训练模型统计信息添加错误计数 #82705 * 将最新的搜索间隔添加到数据馈送统计信息 #82620(问题：#82405) * 为 NLP 模型添加新的 MPNet 标记化 #82234 * 强制删除训练模型 #80595 * 改进了在没有匹配索引的情况下开始滚动数据馈送时的错误消息 #81069(问题：#81013)* 报告训练模型部署的每个节点的线程设置 #81723(问题： #81149) * 为模型修剪窗口设置默认值 30 天 #81377 * 跟踪令牌位置并使用源字符串标记 NER 实体 #81275 * 创建具有异常存储桶跨度的作业时发出警告 #82145(问题：#81645)

Mapping

    

* 仅允许对geo_point字段进行文档值搜索 #83395 * 仅对文档值关键字字段实现所有查询 #83404 * 优化"源字段映射器"中的源过滤 #81970(问题：#77154、#81575)

Monitoring

    

* 添加企业级搜索监控索引模板 #82743 * 将"beats_stats.metrics.apm-server.sampling.tail"添加到堆栈监控模板 #82401

Network

    

* 在 INFO #81768 报告关闭连接异常(问题：#51612、#66473) * 在 netty 缓冲区 #80111 上序列化出站消息 * 跟踪运输处理时间的直方图 #80581(问题：#80428)

Recovery

    

* 根据外部设置调整"索引恢复.max_字节数_每秒" #82819

SQL

    

* 压缩游标 #83591 * 扩展 Tableau 连接器以重新连接目录 #81321

Search

    

* 将"scripted_metric"AGG 上下文添加到"unsigned_long"#64422(问题：#64347) * 添加对向量的字段使用支持 #80608 * 仅允许在布尔字段上搜索文档值 #82925(问题：#82409、#81210、#52728) * 仅允许文档值搜索日期类型 #82602(问题：#82409、#81210、#52728) * 仅允许在 IP 字段 #82929 上搜索文档值(问题：#82409、#81210、#52728) * 仅允许在关键字字段 #82846 上搜索文档值(问题： #82409， #81210， #52728) * 仅允许对数字类型搜索文档值 #82409(问题：#81210、#52728) * 将"匹配"和"match_phrase"查询重写为"关键字"字段上的"术语"查询 #82612(问题：#82515) * 如果读取器有点值，则进行快捷方式 #80268 * 支持将"_shards"首选项参数与<custom-string>""组合 #80024(问题：#80021)

Security

    

* 激活用户配置文件 API #82400 * 为用户配置文件添加初始"配置文件服务" #81899 * 为用户配置文件文档添加新的系统索引 #81355 * 添加更新用户配置文件数据 API #82772 * 添加用户配置文件 API 以通过 UID 获取配置文件 #81910 * 更新 Kibana 系统用户权限 #82781

Snapshot/Restore

    

* 添加 Linux x86-64 位本机方法，以检索磁盘上为文件分配的字节数 #80437 (问题： #79698)

Stats

    

* 在集群统计信息中添加索引压力统计信息 #80303(问题：#79788) * 优化"索引分段响应"中的"获取索引" #80064 * 加快协调节点上的"映射统计"计算 #82830

TSDB

    

* 将"_tsid"字段添加到"time_series"索引 #80276 * 在 TSDB 索引中设置时间边界 #81146

Transform

    

* 引入"deduce_mappings"转换设置 #82256(问题：#82559) * 可以清除现有转换的保留策略 #82703(问题：#82560) * 将没有配置的转换报告为错误 #81141(问题：#80955)

### 新功能

Authentication

    

* JWT 领域 #82175 的初始版本 * 引入域设置以关联领域 #81968

Distributed

    

* 添加所需节点 API #82975

Geo

    

* 新的"GeoHexGrid"聚合 #82924

Health

    

* 新运行状况报告 API 的模型 #83398

TSDB

    

* 处理"routing_path"中的"fields.with.dots"#83148

Transform

    

* 添加转换重置 API #79828(问题：#75768)

###Upgrades

Geo

    

*更新矢量瓷砖谷歌protobuf到3.16.1 #83402

Network

    

* 升级到 Netty 4.1.73 #82844

Packaging

    

* 将 JDK 捆绑到 17.0.2+8 #83243(问题：#83242)

Security

    

* 将 jANSI 依赖项升级到 2.4.0 #83566

[« Elasticsearch version 8.1.1](release-notes-8.1.1.md) [Elasticsearch
version 8.0.1 »](release-notes-8.0.1.md)
