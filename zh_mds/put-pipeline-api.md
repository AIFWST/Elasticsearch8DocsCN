

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[REST
APIs](rest-apis.md) ›[Ingest APIs](ingest-apis.md)

[« Ingest APIs](ingest-apis.md) [Delete pipeline API »](delete-pipeline-
api.md)

## 创建或更新管道API

创建或更新引入管道。使用此 API 所做的更改将立即生效。

    
    
    response = client.ingest.put_pipeline(
      id: 'my-pipeline-id',
      body: {
        description: 'My optional pipeline description',
        processors: [
          {
            set: {
              description: 'My optional processor description',
              field: 'my-keyword-field',
              value: 'foo'
            }
          }
        ]
      }
    )
    puts response
    
    
    PUT _ingest/pipeline/my-pipeline-id
    {
      "description" : "My optional pipeline description",
      "processors" : [
        {
          "set" : {
            "description" : "My optional processor description",
            "field": "my-keyword-field",
            "value": "foo"
          }
        }
      ]
    }

###Request

'PUT /_ingest/pipeline/<pipeline>'

###Prerequisites

* 如果启用了 Elasticsearch 安全功能，您必须具有"manage_pipeline"、"manage_ingest_pipelines"或"管理"集群权限才能使用此 API。

### 路径参数

`<pipeline>`

     (Required, string) ID of the ingest pipeline to create or update. 

### 查询参数

`if_version`

     (Optional, integer) Perform the operation only if the pipeline has this version. If specified and the update is successful, the pipeline's version is incremented. 
`master_timeout`

     (Optional, [time units](api-conventions.html#time-units "Time units")) Period to wait for a connection to the master node. If no response is received before the timeout expires, the request fails and returns an error. Defaults to `30s`. 
`timeout`

     (Optional, [time units](api-conventions.html#time-units "Time units")) Period to wait for a response. If no response is received before the timeout expires, the request fails and returns an error. Defaults to `30s`. 

### 请求正文

`description`

     (Optional, string) Description of the ingest pipeline. 
`on_failure`

    

(可选，处理器对象数组)处理器在处理器故障后立即运行。

每个处理器都支持处理器级别的"on_failure"值。如果没有"on_failure"值的处理器发生故障，Elasticsearch 会使用此管道级参数作为回退。此参数中的处理器按指定的顺序按顺序运行。Elasticsearch 不会尝试运行管道的剩余处理器。

`processors`

     (Required, array of [processor](processors.html "Ingest processor reference") objects) Processors used to perform transformations on documents before indexing. Processors run sequentially in the order specified. 
`version`

    

(可选，整数)外部系统用于跟踪引入管道的版本号。

请参阅上面的"if_version"参数，了解如何使用版本属性。

`_meta`

     (Optional, object) Optional metadata about the ingest pipeline. May have any contents. This map is not automatically generated by Elasticsearch. 

###Examples

#### 管道元数据

可以使用"_meta"参数将任意元数据添加到管道。此用户定义的对象存储在群集状态中，因此最好保持简短。

"_meta"参数是可选的，不会由Elasticsearch自动生成或使用。

要取消设置"_meta"，请替换管道而不指定管道。

    
    
    response = client.ingest.put_pipeline(
      id: 'my-pipeline-id',
      body: {
        description: 'My optional pipeline description',
        processors: [
          {
            set: {
              description: 'My optional processor description',
              field: 'my-keyword-field',
              value: 'foo'
            }
          }
        ],
        _meta: {
          reason: 'set my-keyword-field to foo',
          serialization: {
            class: 'MyPipeline',
            id: 10
          }
        }
      }
    )
    puts response
    
    
    PUT /_ingest/pipeline/my-pipeline-id
    {
      "description" : "My optional pipeline description",
      "processors" : [
        {
          "set" : {
            "description" : "My optional processor description",
            "field": "my-keyword-field",
            "value": "foo"
          }
        }
      ],
      "_meta": {
        "reason": "set my-keyword-field to foo",
        "serialization": {
          "class": "MyPipeline",
          "id": 10
        }
      }
    }

若要检查"_meta"，请使用获取管道 API。

[« Ingest APIs](ingest-apis.md) [Delete pipeline API »](delete-pipeline-
api.md)
