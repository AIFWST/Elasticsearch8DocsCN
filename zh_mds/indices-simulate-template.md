

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[REST
APIs](rest-apis.md) ›[Index APIs](indices.md)

[« Simulate index API](indices-simulate-index.md) [Split index API
»](indices-split-index.md)

## 模拟索引模板API

返回将由特定索引模板应用的索引配置。

    
    
    POST /_index_template/_simulate/template_1

###Request

"发布/_index_template/_simulate/<index-template>"

###Prerequisites

* 如果启用了 Elasticsearch 安全功能，您必须具有"manage_index_templates"或"管理"集群权限才能使用此 API。

### 路径参数

`<index-template>`

     (Optional, string) Name of the index template to simulate. To test a template configuration before you add it to the cluster, omit this parameter and specify the template configuration in the request body. 

### 查询参数

`create`

     (Optional, Boolean) If `true`, the template passed in the body is only used if no existing templates match the same index patterns. If `false`, the simulation uses the template with the highest priority. Note that the template is not permanently added or updated in either case; it is only used for the simulation. Defaults to `false`. 
`master_timeout`

     (Optional, [time units](api-conventions.html#time-units "Time units")) Period to wait for a connection to the master node. If no response is received before the timeout expires, the request fails and returns an error. Defaults to `30s`. 
`include_defaults`

     (Optional, Boolean) Functionality in  [preview]  This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.  . If `true`, return all default settings in the response. Defaults to `false`. 

### 请求正文

`data_stream`

    

(可选，对象)如果包含此对象，则模板用于创建数据流及其支持索引。支持空对象。

数据流需要具有"data_stream"对象的匹配索引模板。请参见创建索引模板。

"data_stream"的属性

`allow_custom_routing`

     (Optional, Boolean) If `true`, the data stream supports [custom routing](mapping-routing-field.html "_routing field"). Defaults to `false`. 
`hidden`

     (Optional, Boolean) If `true`, the data stream is [hidden](api-conventions.html#multi-hidden "Hidden data streams and indices"). Defaults to `false`. 
`index_mode`

    

(可选，字符串)要创建的数据流的类型。有效值为"null"(常规数据流)和"time_series"(时间序列数据流"))。

如果为"time_series"，则每个后备索引的"index.mode"索引设置为"time_series"。

`index_patterns`

    

(必需，字符串数组)通配符 ('*') 表达式数组，用于在创建过程中匹配数据流和索引的名称。

Elasticsearch 包含多个内置索引模板。若要避免与这些模板发生命名冲突，请参阅避免索引模式冲突。

`_meta`

     (Optional, object) Optional user metadata about the index template. May have any contents. This map is not automatically generated by Elasticsearch. 
`priority`

     (Optional, integer) Priority to determine index template precedence when a new data stream or index is created. The index template with the highest priority is chosen. If no priority is specified the template is treated as though it is of priority 0 (lowest priority). This number is not automatically generated by Elasticsearch. 
`template`

    

(可选，对象)要应用的模板。它可以选择性地包括"别名"、"映射"或"设置"配置。

"模板"的属性

`aliases`

    

(可选，对象的对象)要添加的别名。

如果索引模板包含"data_stream"对象，则这些是数据流别名。否则，这些是索引别名。数据流别名会忽略"index_routing"、"路由"和"search_routing"选项。

"别名"对象的属性

`<alias>`

    

(必填，对象)键是别名。索引别名支持日期数学。

对象正文包含别名的选项。支持空对象。

""的属性<alias>

`filter`

     (Optional, [Query DSL object](query-dsl.html "Query DSL")) Query used to limit documents the alias can access. 
`index_routing`

     (Optional, string) Value used to route indexing operations to a specific shard. If specified, this overwrites the `routing` value for indexing operations. 
`is_hidden`

     (Optional, Boolean) If `true`, the alias is [hidden](api-conventions.html#multi-hidden "Hidden data streams and indices"). Defaults to `false`. All indices for the alias must have the same `is_hidden` value. 
`is_write_index`

     (Optional, Boolean) If `true`, the index is the [write index](aliases.html#write-index "Write index") for the alias. Defaults to `false`. 
`routing`

     (Optional, string) Value used to route indexing and search operations to a specific shard. 
`search_routing`

     (Optional, string) Value used to route search operations to a specific shard. If specified, this overwrites the `routing` value for search operations. 

`mappings`

    

(可选，映射对象)索引中字段的映射。如果指定，此映射可以包括：

* 字段名称 * 字段数据类型 * 映射参数

请参阅映射。

`settings`

     (Optional, [index setting object](index-modules.html#index-modules-settings "Index Settings")) Configuration options for the index. See [Index Settings](index-modules.html#index-modules-settings "Index Settings"). 

`version`

     (Optional, integer) Version number used to manage index templates externally. This number is not automatically generated by Elasticsearch. 

### 响应正文

`overlapping`

    

(阵列)被指定模板取代的任何模板。

"重叠"的属性

`index_patterns`

     (array) Index patterns that the superseded template applies to. 
`name`

     (string) Name of the superseded template. 

`template`

    

(对象)将应用于匹配索引的设置、映射和别名。

"模板"的属性

`aliases`

    

(可选，对象的对象)索引的别名。如果索引模板包含"data_stream"，则不支持此参数。

"别名"对象的属性

`<alias>`

    

(必填，对象)键是别名。索引别名支持日期数学。

对象正文包含别名的选项。支持空对象。

""的属性<alias>

`filter`

     (Optional, [Query DSL object](query-dsl.html "Query DSL")) Query used to limit documents the alias can access. 
`index_routing`

     (Optional, string) Value used to route indexing operations to a specific shard. If specified, this overwrites the `routing` value for indexing operations. 
`is_hidden`

     (Optional, Boolean) If `true`, the alias is [hidden](api-conventions.html#multi-hidden "Hidden data streams and indices"). Defaults to `false`. All indices for the alias must have the same `is_hidden` value. 
`is_write_index`

     (Optional, Boolean) If `true`, the index is the [write index](aliases.html#write-index "Write index") for the alias. Defaults to `false`. 
`routing`

     (Optional, string) Value used to route indexing and search operations to a specific shard. 
`search_routing`

     (Optional, string) Value used to route search operations to a specific shard. If specified, this overwrites the `routing` value for search operations. 

`mappings`

    

(可选，映射对象)索引中字段的映射。如果指定，此映射可以包括：

* 字段名称 * 字段数据类型 * 映射参数

请参阅映射。

`settings`

     (Optional, [index setting object](index-modules.html#index-modules-settings "Index Settings")) Configuration options for the index. See [Index Settings](index-modules.html#index-modules-settings "Index Settings"). 

###Examples

#### 模拟现有模板

以下示例创建并模拟组合模板：

    
    
    response = client.cluster.put_component_template(
      name: 'ct1',
      body: {
        template: {
          settings: {
            "index.number_of_shards": 2
          }
        }
      }
    )
    puts response
    
    response = client.cluster.put_component_template(
      name: 'ct2',
      body: {
        template: {
          settings: {
            "index.number_of_replicas": 0
          },
          mappings: {
            properties: {
              "@timestamp": {
                type: 'date'
              }
            }
          }
        }
      }
    )
    puts response
    
    response = client.indices.put_index_template(
      name: 'final-template',
      body: {
        index_patterns: [
          'my-index-*'
        ],
        composed_of: [
          'ct1',
          'ct2'
        ],
        priority: 5
      }
    )
    puts response
    
    response = client.indices.simulate_template(
      name: 'final-template'
    )
    puts response
    
    
    PUT /_component_template/ct1                   __{
      "template": {
        "settings": {
          "index.number_of_shards": 2
        }
      }
    }
    
    PUT /_component_template/ct2 __{
      "template": {
        "settings": {
          "index.number_of_replicas": 0
        },
        "mappings": {
          "properties": {
            "@timestamp": {
              "type": "date"
            }
          }
        }
      }
    }
    
    PUT /_index_template/final-template __{
      "index_patterns": ["my-index-*"],
      "composed_of": ["ct1", "ct2"],
      "priority": 5
    }
    
    POST /_index_template/_simulate/final-template __

__

|

创建一个组件模板 ('ct1')，将分片数设置为 2 ---|--- __

|

创建一个组件模板 ('ct2')，将副本数设置为 0 并定义映射 __

|

创建使用组件模板 __ 的索引模板("最终模板")

|

显示"最终模板"应用的配置 响应显示"最终模板"应用的索引设置、映射和别名：

    
    
    {
      "template" : {
        "settings" : {
          "index" : {
            "number_of_shards" : "2",  __"number_of_replicas" : "0", __"routing" : {
              "allocation" : {
                "include" : {
                  "_tier_preference" : "data_content"
                }
              }
            }
          }
        },
        "mappings" : { __"properties" : {
            "@timestamp" : {
              "type" : "date"
            }
          }
        },
        "aliases" : { }
      },
      "overlapping" : [ ]
    }

__

|

来自"ct1"的分片数 ---|--- __

|

来自"ct2"__ 的副本数

|

来自"ct1"的映射 #### 模拟任意模板配置编辑

若要在将模板添加到群集之前查看模板将应用哪些设置，可以在请求正文中传递模板配置。如果指定的模板的优先级高于现有模板，则将其用于模拟。

    
    
    response = client.indices.simulate_template(
      body: {
        index_patterns: [
          'my-index-*'
        ],
        composed_of: [
          'ct2'
        ],
        priority: 10,
        template: {
          settings: {
            "index.number_of_replicas": 1
          }
        }
      }
    )
    puts response
    
    
    POST /_index_template/_simulate
    {
      "index_patterns": ["my-index-*"],
      "composed_of": ["ct2"],
      "priority": 10,
      "template": {
        "settings": {
          "index.number_of_replicas": 1
        }
      }
    }

响应显示优先级较低的任何重叠模板。

    
    
    {
      "template" : {
        "settings" : {
          "index" : {
            "number_of_replicas" : "1",
            "routing" : {
              "allocation" : {
                "include" : {
                  "_tier_preference" : "data_content"
                }
              }
            }
          }
        },
        "mappings" : {
          "properties" : {
            "@timestamp" : {
              "type" : "date"
            }
          }
        },
        "aliases" : { }
      },
      "overlapping" : [
        {
          "name" : "final-template",
          "index_patterns" : [
            "my-index-*"
          ]
        }
      ]
    }

[« Simulate index API](indices-simulate-index.md) [Split index API
»](indices-split-index.md)
