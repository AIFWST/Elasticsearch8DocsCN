

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Roll up or
transform your data](data-rollup-transform.md) ›[Rolling up historical
data](xpack-rollup.md)

[« Rolling up historical data](xpack-rollup.md) [Rollup API quick reference
»](rollup-api-quickref.md)

## 汇总概述

此功能为技术预览版，可能会在将来的版本中进行更改或删除。Elastic 将尽最大努力修复任何问题，但技术预览版中的功能不受官方 GA 功能的 SLA 支持的约束。

对于版本 8.5 及更高版本，我们建议对汇总进行缩减采样，以降低时序数据的存储成本。

基于时间的数据(主要由时间戳标识的文档)通常具有关联的保留策略来管理数据增长。例如，您的系统可能每秒生成 500 个文档。这将每天生成 4300 万份文档，每年生成近 160 亿份文档。

虽然您的分析师和数据科学家可能希望您无限期地存储这些数据以供分析，但时间是永无止境的，因此您的存储需求将继续无限增长。因此，保留策略通常取决于一段时间内存储成本的简单计算，以及组织愿意为保留历史数据支付的费用。通常，这些策略会在几个月或几年后开始删除数据。

存储成本是固定数量。存储 Y 数据需要 X 钱。但是一段数据的效用通常会随着时间的推移而变化。以毫秒粒度收集的传感器数据现在非常有用，如果从几周前开始，则非常有用，如果超过几个月，则仅略有用。

因此，虽然存储十年前一毫秒传感器数据的成本是固定的，但单个传感器读数的价值通常会随着时间的推移而减少。它并非毫无用处 -- 它很容易有助于有用的分析 -- 但它的价值降低通常会导致删除，而不是支付固定的存储成本。

#### 汇总以降低的粒度存储历史数据

这就是Rollup发挥作用的地方。汇总功能将旧的高粒度数据汇总为降低粒度的格式，以便长期存储。通过将数据"汇总"到单个摘要文档中，与原始数据相比，可以大大压缩历史数据。

例如，考虑每天生成 4300 万个文档的系统。逐秒数据对于实时分析很有用，但查看十年以上数据的历史分析可能会以更大的间隔(例如每小时或每天的趋势)工作。

如果我们将 4300 万个文档压缩为每小时的摘要，我们可以节省大量空间。汇总功能可自动执行此汇总历史数据的过程。

有关设置和配置汇总的详细信息，请参阅创建作业 API。

#### 汇总使用标准查询 DSL

汇总功能公开一个新的搜索终结点("/_rollup_search"与标准"/_search")，该终结点知道如何搜索汇总数据。重要的是，这个端点接受100%正常的Elasticsearch Query DSL。您的应用程序不需要学习新的 DSL 来检查历史数据，它可以简单地重用现有的查询和仪表板。

可用的功能存在一些限制;并非所有查询和聚合都受支持，某些搜索功能(突出显示等)处于禁用状态，可用字段取决于汇总的配置方式。汇总搜索限制中详细介绍了这些限制。

但是，如果您的查询、聚合和仪表板仅使用可用功能，则将它们重定向到历史数据就很容易了。

#### 汇总合并"实时"和"滚动"数据

Rollup 的一个有用功能是能够在单个查询中查询"实时"实时数据以及历史"滚动"数据。

例如，您的系统可能会保留一个月的原始数据。一个月后，它使用汇总汇总到历史摘要中，并删除原始数据。

如果要查询原始数据，则只能看到最近一个月的数据。而且，如果要查询汇总的数据，则只会看到超过一个月的数据。但是，汇总搜索终结点支持同时查询这两个终结点。它将获取来自两个数据源的结果并将它们合并在一起。如果"实时"和"滚动"数据之间存在重叠，则首选实时数据以提高准确性。

#### 汇总是多间隔感知的

最后，汇总能够智能地利用可用的最佳间隔。如果您使用过总结其他产品的功能，您会发现它们可能会受到限制。如果每天配置汇总...您的查询和图表只能使用每日间隔。如果需要每月间隔，则必须创建另一个显式存储每月平均值等的汇总。

汇总功能以这样一种方式存储数据，即查询可以识别最小的可用间隔并将其用于处理。如果按天间隔存储汇总，则可以按每日或更长的间隔(每周、每月等)执行查询，而无需显式配置新的汇总作业。这有助于减轻汇总系统的主要缺点之一;相对于原始数据的灵活性降低。

[« Rolling up historical data](xpack-rollup.md) [Rollup API quick reference
»](rollup-api-quickref.md)
