

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Secure the
Elastic Stack](secure-cluster.md) ›[User authentication](setting-up-
authentication.md)

[« Token-based authentication services](token-authentication-services.md)
[Realms »](realms.md)

## 用户配置文件

用户配置文件功能仅供 Kibana 和 Elastic 的可观测性、企业级搜索和 Elastic 安全解决方案使用。个人用户和外部应用程序不应直接调用此 API。Elastic 保留在未来版本中更改或删除此功能的权利，恕不另行通知。

由于 Elastic Stack 支持外部管理的用户(例如通过 SAML 进行身份验证的用户或存储在 LDAP 目录中的用户)，因此 _users_ 与其 _profile_ 之间存在区别。

_Users_ 是指对 Elastic Stack 的请求进行身份验证的实体。每个用户都有一个用户名和一组权限(由角色表示)，用于确定他们可以发出哪些类型的请求。用户可能是短暂的;它们可能只存在于向 Elasticsearch API 发出请求期间，也可能存在于 Kibana 会话的生命周期内。这些用户在会话结束后无法检索，并且无法跨会话存储首选项。

_User profiles_提供持久稳定的用户表示形式。即使用户处于脱机状态，用户配置文件也存在，因此其配置文件在会话中保持不变。分配给每个配置文件的唯一标识符在部署的整个生存期内不会更改，从而提供了一种稳定的方式来引用关联用户。每个配置文件都有一个唯一的标识符，可搜索，并且可以存储用户数据，例如格式和通知首选项。

无论用户是否反应在线，唯一地引用用户的能力是支撑 Kibana 个性化和协作等重要功能的关键功能。

### Kibana 中的用户配置文件

用户配置文件是 Elastic Stack 为每个向 Kibana 进行身份验证的交互式用户存储的持久记录。

当用户登录到 Kibana 时，将自动为用户创建配置文件，或者更新现有配置文件以反映用户的活动会话。通过使用用户配置文件的唯一 ID，Kibana 可以为每个用户单独存储用户级数据(例如首选项)，这是细粒度自定义级别的关键。Kibana 使用此唯一 ID 将消息和通知路由到不同的用户，无论他们是否已登录。

#### 用户名和用户配置文件

您可以跨多个领域为单个用户使用相同的用户名。在Elasticsearch中，两个不同的领域可以使用相同的用户名和不同的角色对用户进行身份验证。Elasticsearch 不假定这些用户是同一个人，默认情况下将他们视为具有不同用户配置文件的独立个体。

对于一个人可以针对多个领域进行身份验证的用例，您可以使用安全域功能，以便将这些不同的用户视为同一身份并共享单个用户配置文件。

### 创建和管理用户配置文件

要创建新的用户配置文件或更新现有用户配置文件，请使用激活用户配置文件 API。当您提交请求时，Elasticsearch 会尝试查找指定用户的现有配置文件文档。如果不存在，Elasticsearch会创建一个新的配置文件文档。

无论哪种情况，配置文件文档都会捕获用户的"full_name"、"电子邮件"、"角色"和"领域"，还包括配置文件唯一 ID 和操作时间戳。您可以使用获取用户配置文件 API 通过包含配置文件的唯一 ID ('uid') 来检索用户配置文件。

除了用户的基本信息外，您还可以使用更新用户配置文件 API 将数据添加到配置文件文档。例如，您可以将特定于用户的首选项添加为配置文件数据的一部分。

使用建议用户配置文件 API 检索与给定条件匹配的配置文件。此 API 旨在与 Kibana 中的功能等功能协作，支持用户建议。但是，建议用户配置文件 API 并非旨在提供通用搜索 API。

最后，您可以使用用户配置文件的具有权限 API 通过指定多个用户配置文件的唯一 ID 来检查其权限。这可以与建议用户配置文件 API 结合使用，以便将建议限制为仅具有在上下文中实际执行操作的必要权限的用户。

###Limitations

* 创建新的用户配置文件需要用户的身份验证详细信息("用户名"和"密码"或其 OAuth2 访问令牌)。这意味着用户必须至少进行身份验证一次才能创建用户配置文件。从未向 Kibana(或其他配置文件感知应用程序)进行身份验证的用户将没有用户配置文件，并且建议用户配置文件 API 不会为这些用户返回任何结果。  * 用户配置文件适用于交互式用户，例如与 Kibana 交互的人类用户。因此，用户配置文件不支持 API 密钥或服务帐户。

支持表示交互式最终用户的 OAuth2 令牌。

[« Token-based authentication services](token-authentication-services.md)
[Realms »](realms.md)
