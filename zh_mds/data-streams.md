

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md)

[« Usage example](_usage_example.md) [Set up a data stream »](set-up-a-data-
stream.md)

# 数据流

数据流允许您跨多个索引存储仅追加时间序列数据，同时为请求提供单个命名资源。数据流非常适合日志、事件、指标和其他持续生成的数据。

您可以将索引和搜索请求直接提交到数据流。Thestream 会自动将请求路由到存储流数据的后备索引。您可以使用索引生命周期管理 (ILM) 自动管理这些后备索引。例如，可以使用 ILM 自动将较旧的后备索引移动到较便宜的硬件，并删除不需要的索引。ILM 可以帮助您随着数据的增长而降低成本和开销。

## 支持索引

数据流由一个或多个自动生成的隐藏后备索引组成。

！数据流图

数据流需要匹配的索引模板。该模板包含用于配置流的支持索引的映射和设置。

索引到数据流的每个文档都必须包含一个"@timestamp"字段，映射为"日期"或"date_nanos"字段类型。如果索引模板没有为"@timestamp"字段指定映射，Elasticsearch 将使用默认选项将"@timestamp"映射为"日期"字段。

同一个索引模板可用于多个数据流。您无法删除数据流正在使用的索引模板。

支持索引的名称模式是一个实现细节，nointelligence应该从中派生出来。保留的唯一不变是每个数据流生成索引都有一个唯一的名称。

## 读取请求

当您向数据流提交读取请求时，流会将请求路由到其所有后备索引。

！数据流搜索请求

## 写入索引

最近创建的后备索引是数据流的写入索引。Thestream 仅将新文档添加到此索引。

！数据流索引请求

不能将新文档添加到其他后备索引，即使将请求直接发送到索引也是如此。

您也不能对可能妨碍索引的写入索引执行操作，例如：

* 克隆 * 删除 * 收缩 * 拆分

##Rollover

滚动更新会创建一个新的支持索引，该索引将成为流的新写入索引。

我们建议使用 ILM 在写入索引达到指定的期限或大小时自动滚动更新数据流。如果需要，您还可以手动滚动更新数据流。

##Generation

每个数据流都跟踪其生成：一个六位数、零填充的整数，从"000001"开始。

创建后备索引时，使用以下约定命名索引：

    
    
    .ds-<data-stream>-<yyyy.MM.dd>-<generation>

"<yyyy.MM.dd>"是支持索引的创建日期。具有更高世代的支持索引包含更新的数据。例如，"Web-服务器-日志"数据流的生成为"34"。流的最新支持索引创建于 2099 年 3 月 7 日，名为".ds-web-server-logs-2099.03.07-000034"。

某些操作(如收缩或还原)可以更改后备索引的名称。这些名称更改不会从其数据流中删除后备索引。

数据流的生成可以更改，而无需将新索引添加到数据流中(例如，当现有后备索引收缩时)。这意味着某些世代的支持索引将永远不会存在。不应从后备索引名称中获取任何情报。

## 仅追加

数据流专为现有数据很少更新的用例而设计。您不能将现有文档的更新或删除请求直接发送到数据流。请改用按查询更新和按查询删除 API。

如果需要，您可以通过将请求直接提交到文档的支持索引来更新或删除文档。

如果您经常更新或删除现有时序数据，请使用具有写入索引的索引别名，而不是数据流。请参阅在没有数据流的情况下管理时序数据。

[« Usage example](_usage_example.md) [Set up a data stream »](set-up-a-data-
stream.md)
