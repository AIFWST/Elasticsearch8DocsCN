

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Release
notes](es-release-notes.md)

[« Elasticsearch version 8.4.1](release-notes-8.4.1.md) [Elasticsearch
version 8.3.3 »](release-notes-8.3.3.md)

## 弹性搜索版本8.4.0

另请参阅 8.4 中的重大更改。

### 已知问题

* 如果自版本 6.x 以来未修改任何机器学习数据馈送，则无法列出

如果您的数据馈送是在版本 5.x 或 6.x 中创建的，并且自 7.0 版以来未更新，则无法在 8.4 和 8.5 中列出数据馈送。这意味着无法使用 Kibana 管理异常检测作业。此问题已在 8.6.0 中修复。

如果使用此类数据馈送升级到 8.4 或 8.5，则需要通过使用以下步骤更新每个数据馈送的授权信息来解决此问题。

* 使用 'settings.json' 文件配置 Elasticsearch 的编排器可能会在主选举期间遇到死锁(问题：#92812)

要解决死锁，请删除"settings.json"文件并重新启动受影响的节点。

* 当数组中的最后一个元素被过滤掉(例如使用"_source_includes")时解析请求失败。这是由于杰克逊解析器中的一个错误。在 Elasticsearch 8.6.1 中修复 (#91456)

* 使用采集附件处理器时，Tika 与 log4j 2.18.0 及更高版本(在 Elasticsearch 8.4.0 中引入)的交互会导致日志记录过多。此日志记录过多，可能导致群集不稳定，直至群集不可用且必须重新启动节点。(问题：#91964)。此问题已在 Elasticsearch 8.7.0 (#93878) 中修复

要解决此问题，请升级到 8.7.0 或更高版本。

### 错误修正

Aggregations

    

* 修复复合 agg #88638 中的多值处理 * 修复：使用"bucket_selector""buckets_path"提取矩阵统计信息 #88271(问题：#87454) * 将"buckets_path"参数中的指标设为可选 #87220(问题：#72983) * 将别名过滤器传播到重要性 aggs 过滤器 #88221(问题：#81585)

Allocation

    

* 将自动扩展副本固定到最接近的值 #87505(问题：#84788) * 在某些情况下防止使用过时的节点权重进行重新平衡 #88385(问题：#88384) * 当"cluster.routing.allocation.disk.threshold_enabled"设置为"false"时，删除任何现有的"read_only_allow_delete"索引块 #87841(问题：#86383) * 将运行状况请求替换为状态观察器 #88641

Authentication

    

* 修复唯一领域名称检查以覆盖默认领域 #87999

Authorization

    

* 为"remote_monitoring_agent"添加翻转权限 #87717(问题：#84161)

Autoscaling

    

* 收缩期间自动缩放 #88292(问题：#85480) * 不要在快照中包含所需的节点 #87695

集群协调

    

* 改进了对模棱两可的投票配置名称的拒绝 #89239

数据流

    

* 修复了使用 CCR 复制重命名数据流的问题 #88875(问题：#81751)

Distributed

    

* 修复了批量请求的空指针异常 #88385

EQL

    

* 避免在 PIT 打开失败时尝试 PIT 关闭 #87498 * 提高 EQL 顺序断路器精度 #88538(问题：#88300)

Geo

    

* 当生成的行只有一个点时，Geo_line聚合将返回一个 geojson 点 #89199(问题：#85748) * 在"geo_distance"聚合中对范围进行排序 #89154(问题：#89147)

Health

    

* 修复检查上次快照是否成功时的 NPE #88811 * 修复主稳定性功能的版本检查 #89322 * 修复内部操作名称 #89182 * 使用正确的连接获取远程主历史记录 #87299

Highlighting

    

* 在多输入的普通荧光笔中处理订购 #87414(问题：#87210)

ILM+SLM

    

* 批量 ILM 移动到重试步骤任务更新 #86759

Infra/CLI

    

* 在 Windows 服务 CLI 中引用带有空格的路径 #89072(问题：#89043)

Infra/Core

    

* 始终关闭目录流 #88560 * 删除系统索引的无效设置 #88903(问题：#88324) * 不允许三位数次要版本和修订版本 #87338 * 在文件设置中处理快照还原 #89321(问题：#89183)* 系统索引忽略所有用户模板 #87260(问题：#42508、#74271)

基础设施/节点生命周期

    

* 修复了关机停止的消息 #89254

Infra/Plugins

    

* 在 SPIClassIterator #88586 中禁用 URL 连接缓存(问题：#88275)

Infra/Scripting

    

* 脚本："UpdateByQuery"可以读取文档版本，如果请求 #88740

机器学习

    

* 解决了训练模型在分配给节点 #88945 后卡在启动中的潜在错误 * 修复处理 unicode 重音时的 BERT 和 MPNet 标记化错误 #88907(问题：#88900) * 修复最佳答案只有一个令牌时的 NLP"question_answering"任务 #88347 * 在"_stats"中包含未启动模型部署的启动参数 #89091 * 修复了将fill_mask任务与 roberta 标记器一起使用时的小标记化错误 #88825 * 修复分类和回归作业的潜在原因失败 #2385

Mapping

    

* 解析映射时为合并的对象分配正确的路径 #89389(问题：#88573) * 解析复合运行时字段时不要修改源映射 #89114

Network

    

* 确保扩展套接字选项TCP_KEEPXXX可用 #88935(问题：#88897)

SQL

    

* 修复"SqlSearchIT""测试所有类型与请求到旧节点"#88883(问题：#88866)* 修复日期范围检查 #87151(问题：#77179) * 修复对象等于 #87887

Search

    

* 修复：使用状态码 500 进行聚合，减少分片失败时的相位错误 #88551(问题：#20004) * 覆盖可退出点访问者的批量访问方法 #82120

Security

    

* 确保"安全字符串"在重新加载安全设置时保持打开状态 #88922

Snapshot/Restore

    

* 修复部分快照因删除而失败后排队的快照分配 #88470(问题：#86724)

Transform

    

* 正确处理更新错误 #88619

###Deprecations

矢量搜索

    

* 弃用"_knn_search"端点 #88828

###Enhancements

Aggregations

    

* 为"random_sampler"添加基数支持 AGG #86838 * 次要的"RangeAgg"优化 #86935(问题：#84262) * 速度计数过滤器/范围/date_histogram AGGS #81322 * 更新存储桶指标管道 agg 路径，以允许中间单存储桶和存储桶合格的多存储桶 AGG #85729

Allocation

    

* 将有关已分配和未分配分片的调试信息添加到"ReactiveReason" #86132(问题：#85243) * 优化日志集群运行状况性能。#87723 * 在数据层分配决策期间使用所需的节点 #87735

Audit

    

* 创建或授予 API 密钥时审核 API 密钥 ID #88456 * 在创建、授予或更新 API 密钥时，在审核日志中包含 API 密钥元数据 #88642 * 可更新的 API 密钥 - 记录审核跟踪事件 #88276 * 用户配置文件 - 安全域的审核支持 #87097

Authentication

    

* 如果签名验证失败，请重新加载 JWK，如果找到新的 JWK，请重试 #88023

Authorization

    

* 具有操作模式的应用权限不会检索权限 #85455 * 可取消配置文件具有权限检查 #87224 * 权限不足的用户("manage_own_api_key")尝试授予 API 密钥请求时返回操作被拒绝错误 #87461(问题：#87438) * 将索引权限更新到企业级搜索服务帐户 #88703

Autoscaling

    

* 将处理器添加到自动扩展容量响应 #87895 * 跟踪群集状态中的所需节点状态 #87474

集群协调

    

* 在持久群集状态下删除重复映射 #88479 * 在 PCSS 调试日志中公开段详细信息 #87412 * 对带有种子主机的 1 节点群集发出定期警告 #88013(问题：#85222) * 在群集统计信息中报告总体映射大小 #87556

数据流

    

* 为指标模板上的数值字段提供仅文档值的映射 #87100

Distributed

    

* 添加向协调器注册"PeerFinderListener"的功能 #88626 * 使所需节点 API 仅操作员 #87778(问题：#87777) * 支持"试运行"模式以更新所需节点 #88305

FIPS

    

* 在 FIPS 模式下不建议使用缓存使用的哈希函数时的日志警告 #86740 * 存储的 API 密钥或服务令牌的哈希器不符合 FIPS 时的日志警告 #87363

Geo

    

* 优化单例点的地质格栅聚合 #87439 * 支持带有文档值的笛卡尔形状 #88487 * 使用更快但不太准确的对数算法计算地理导线 Y 坐标 #87515 * 使用更快的数学运算将 WGS84 投影到墨卡托 #88231

Health

    

* 为不正常的 SLM 策略失败计数添加运行状况用户操作 #88523 * 添加传输操作以获取群集形成信息 #87306 * 向"master_is_stable"运行状况指示器服务添加其他功能 #87482 * 为"协调诊断服务"创建传输操作 #87984 * 将主稳定性逻辑移动到独立于"运行状况指示器服务"的自己的服务中 #87672 * 轮询主站稳定运行状况指示器的群集形成状态 #88397 * 从运行状况 API 中删除群集块预检检查 #87520(问题：#87464)

ILM+SLM

    

* 向翻转添加min_* 条件 #83345 * 跟踪自上次成功策略快照 #88398 以来失败的调用计数

Infra/Core

    

* 改进控制台异常消息 #87942 * 控制台非交互式时打印完整异常 #88297 * 执行强制合并索引生命周期管理操作时停止将索引设为只读 #81162 (问题： #81162) * 流输入和输出支持可选集合 #88127 * 更新内部 http 客户端版本 #87491

Infra/Logging

    

* 格式化字符串失败时捕获异常 #87132

Infra/Scripting

    

* 脚本：将元数据添加到摄取上下文 #87309 * 脚本：更新上下文的元数据 #88333

Infra/Settings

    

* 将磁盘水印转换为相对字节大小值 #88719

Ingest

    

* 允许管道处理器忽略缺少的管道 #87354 * 将摄取附件处理器移动到默认分配 #87989 * 仅在需要时在摄取期间执行"确保NoSelfReferences"检查 #87352(问题：#87335) * 从摄取附件插件中删除"BouncyCastle"依赖项 #88031

机器学习

    

* 将授权信息添加到 ML 配置列表 #87884 * 将部署的本机模型添加到训练模型统计信息响应中的"inference_stats" #88187 * 将推理缓存命中计数添加到推理节点统计信息 #88807 * 将新的"cache_size"参数添加到"trained_model"部署 API #88450 * 将允许的 NER 标签扩展为任何 I-O-B 标记标签 #87091 * 提高 NLP 模型的可扩展性 #87366 * 指示所有节点路由都失败时的总体部署失败 #88378 * 新的"frequent_items"聚合 #83055 * 在训练分类和回归模型的模型选择中更公平地应用大小惩罚 #2291 * 如果没有必要，则跳过微调参数，从而加速数据帧分析的训练 #2298 * 解决在具有许多功能的大型数据集上训练回归和分类模型运行时高的一些原因 #2332 * 为 PyTorch 推理添加缓存 #2305 * 提高异常检测中位数估计的准确性 #2367(问题： #2364)

Mapping

    

* 在常量关键字字段上启用合成源支持 #88603 * 加速"数字字段映射器" #85688

Monitoring

    

* JvmService 使用 SingleObjectCache #87236

Network

    

* 允许使用无法访问的远程群集启动群集 #87298 * 将"http.max_header_size"默认值增加到 16kb #88725(问题：#88501)

查询语言

    

* 在 SQL 和 EQL 中添加对 VERSION 字段类型的支持 #87590(问题：#83375)

Rollup

    

* TSDB] 将 Kahan 支持添加到降采样求和 [#87554

SQL

    

* 在 SQL CLI 中实现对部分搜索结果的支持 #86982(问题：#86082) * 更新 Tableau 连接器以使用连接对话框 v2 #88462

Search

    

* 为索引的"dense_vectors"添加映射统计信息 #86859 * 改进了对不兼容类型进行排序时的错误 #88399(问题：#73146) * 在磁盘使用操作 #88785 中支持 kNN 向量(问题：#84801)

Security

    

* 为 oidc 反向通道添加"tcp_keepalive"设置 #87868 * 授予 API 密钥时支持"run_as"其他用户 #88335 * 支持 API 密钥查询存在查询 #87229 * 可更新的 API 密钥 - REST API 规范和测试 #88270 * 可更新的 API 密钥 - noop 检查 #88346

Snapshot/Restore

    

* 快照还原和完成的信息日志记录 #88257 (问题： #86610) * 在数据 blob 删除期间，使快照删除不阻止存储库 #86514 * 在所有 S3 获得进展失败后重试 #88015(问题：#87243) * 在不删除快照的情况下加快创建新的"索引元数据生成" #88344 * 将 HDFS 存储库更新为 HDFS 3.3.3 #88039

Stats

    

* 按用途对摄取管道统计信息进行排序 #88035

TLS

    

* 将颁发者添加到 GET _ssl/证书 #88445

Transform

    

* 添加授权信息以转换配置列表 #87570 * 实现每个转换num_failure_retries设置 #87361

### 新功能

Authentication

    

* 支持更新 API 密钥属性(单操作路由)#88186

Health

    

* 主稳定性健康指示器第 1 部分(最近看到主数据时)#86524 * 删除help_url，将摘要重命名为症状，将"user_actions"重命名为诊断 #88553(问题：#88474)

Infra/Core

    

* 文件设置服务 #88329

Infra/Logging

    

* 稳定的日志记录 API - 基本用例 #86612

机器学习

    

* 使数据馈送中的复合 agg 正式发布 #88589

Search

    

* 将 _mode_ 选项添加到"_source"字段映射器 #88211

TSDB

    

* TSDB：对时序索引实施缩减采样 ILM 操作 #87269(问题：#68609)

矢量搜索

    

* 将 ANN 集成到"_search"端点 #88694(问题：#87625)

###Upgrades

Infra/Core

    

* 升级到 Log4J 2.18.0 #88237

Network

    

* 升级到 Netty 4.1.77 #86630

[« Elasticsearch version 8.4.1](release-notes-8.4.1.md) [Elasticsearch
version 8.3.3 »](release-notes-8.3.3.md)
