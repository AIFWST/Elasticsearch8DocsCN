

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Ingest
pipelines](ingest.md) ›[Ingest processor reference](processors.md)

[« Date index name processor](date-index-name-processor.md) [Dot expander
processor »](dot-expand-processor.md)

## 剖析处理器

与 Grok 处理器类似，剖析也从文档中的单个文本字段中提取结构化字段。但是，与 Grok 处理器不同的是，dissect 不使用正则表达式。这使得dissect的语法很简单，在某些情况下比GrokProcessor更快。

剖析将单个文本字段与定义的模式进行匹配。

例如，以下模式：

    
    
    %{clientip} %{ident} %{auth} [%{@timestamp}] \"%{verb} %{request} HTTP/%{httpversion}\" %{status} %{size}

将匹配以下格式的日志行：

    
    
    1.2.3.4 - - [30/Apr/1998:22:00:52 +0000] \"GET /english/venues/cities/images/montpellier/18.gif HTTP/1.0\" 200 3171

并生成包含以下字段的文档：

    
    
    "doc": {
      "_index": "_index",
      "_type": "_type",
      "_id": "_id",
      "_source": {
        "request": "/english/venues/cities/images/montpellier/18.gif",
        "auth": "-",
        "ident": "-",
        "verb": "GET",
        "@timestamp": "30/Apr/1998:22:00:52 +0000",
        "size": "3171",
        "clientip": "1.2.3.4",
        "httpversion": "1.0",
        "status": "200"
      }
    }

剖析模式由将被丢弃的字符串部分定义。在上面的示例中，要丢弃的第一部分是单空格。Dissect找到这个空间，然后分配"clientip"的值是该空间之前的所有内容。稍后的剖析匹配"["，然后匹配"]"，然后将"@timestamp"分配给"["和"]"之间的所有内容。特别注意要丢弃的字符串部分将有助于建立成功的解剖模式。

成功的匹配要求模式中的所有键都具有值。如果模式中定义的任何"%{keyname}"没有值，则会抛出异常，并可能由"on_failure"指令处理。空键"%{}"或命名的跳过键可用于匹配值，但从最终文档中排除该值。所有匹配的值都表示为字符串数据类型。转换处理器可用于转换为预期的数据类型。

Dissect 还支持可以更改 Dissect 默认行为的键修饰符。例如，您可以指示剖析忽略某些字段，附加字段，跳过填充等。有关更多信息，请参见下文。

**表 13.剖析选项**

姓名 |必填 |默认 |描述 ---|---|---|--- 'field'

|

yes

|

-

|

剖析"模式"的领域

|

yes

|

-

|

应用于字段"append_separator"的模式

|

no

|

""(空字符串)

|

分隔追加字段的字符。   "ignore_missing"

|

no

|

false

|

如果"true"和"field"不存在或为"null"，处理器将悄悄退出而不修改文档"描述"

|

no

|

-

|

处理器的说明。用于描述处理器的目的或其配置。   "如果"

|

no

|

-

|

有条件地执行处理器。请参阅有条件运行处理器。   "ignore_failure"

|

no

|

`false`

|

忽略处理器的故障。请参阅处理管道故障。   "on_failure"

|

no

|

-

|

处理处理器的故障。请参阅处理管道故障。   "标签"

|

no

|

-

|

处理器的标识符。对于调试和指标很有用。               { "dissect"： { "field"： "message"， "pattern" ： "%{clientip} %{ident} %{auth} [%{@timestamp}] \"%{verb} %{request} HTTP/%{httpversion}\" %{status} %{size}" } }

### 剖析键修饰符

键修饰符可以更改剖析的默认行为。键修饰符可以在"%{键名}"的左侧或右侧找到，始终位于"%{"和"}"内。例如，'%{+keyname ->}' 具有追加和右填充修饰符。

**表 14.剖析关键修饰符**

修饰符 |姓名 |职位 |示例 |描述 |详细信息 ---|---|---|---|---|--- '->'

|

跳过右边距

|

(远)右

|

`%{keyname1->}`

|

跳过右侧的任何重复字符

|

链接")"+"

|

Append

|

left

|

'%{+keyname} %{+keyname}'

|

将两个或多个字段追加在一起

|

将"+"与"/n"链接

|

追加顺序

|

左右

|

'%{+keyname/2} %{+keyname/1}'

|

按指定顺序将两个或多个字段追加在一起

|

链接"？

|

命名跳过键

|

left

|

`%{?ignoreme}`

|

跳过输出中的匹配值。与"%{}"相同的行为

|

链接"*"和"&"

|

引用键

|

left

|

'%{*r1} %{&r1}'

|

将输出键设置为值"*"，将输出值设置为"&"

|

链接 #### 右填充修饰符('->')编辑

执行剖析的算法非常严格，因为它要求模式中的所有字符都与源字符串匹配。例如，模式 '%{fookey} %{barkey}' (1 个空格) 将匹配字符串 "foo bar" (1 空格)，但不会匹配字符串 "foo bar"(2 个空格)，因为模式只有 1 个空格，源字符串有 2 个空格。

在这种情况下，正确的填充修饰符会有所帮助。将正确的填充修饰符添加到模式 '%{fookey->} %{barkey}' 中，它现在将匹配 "foobar"(1 个空格)和 "foo bar"(2 个空格)，甚至 "foo bar"(10 个空格)。

使用右填充修饰符允许在"%{keyname->}"之后重复字符。

右填充修饰符可以与任何其他修饰符一起放置在任何键上。它应该始终是最右的修饰符。例如："%{+keyname/1->}" 和 '%{->}'

右填充修饰符示例

**Pattern**

|

'%{ts->} %{level}' ---|--- **Input**

|

1998-08-10T17：15：42，466 警告**结果**

|

* ts = 1998-08-10T17：15：42，466 * 级别 = 警告

右填充修饰符可以与空键一起使用，以帮助跳过不需要的数据。例如，相同的输入字符串，但用括号括起来，需要使用空的右填充键才能获得相同的结果。

带有空键的右填充修饰符示例

**Pattern**

|

'[%{ts}]%{->}[%{level}]' ---|--- **Input**

|

[1998-08-10T17：15：42，466][战] **结果**

|

* ts = 1998-08-10T17：15：42，466 * 级别 = 警告

#### 追加修饰符('+')编辑

剖析支持将两个或多个结果追加在一起以进行输出。值从左到右追加。可以指定追加分隔符。在此示例中，append_separator定义为空格。

追加修饰符示例

**Pattern**

|

'%{+name} %{+name} %{+name} %{+name}' ---|--- **Input**

|

约翰·雅各布·金格尔海默·施密特 **结果**

|

* 姓名 = 约翰·雅各布·金格尔海默·施密特

#### 追加顺序修饰符("+"和"/n")编辑

剖析支持将两个或多个结果追加在一起以进行输出。值根据定义的顺序("/n")追加。可以指定追加分隔符。在此示例中，append_separator定义为逗号。

追加顺序修饰符示例

**Pattern**

|

'%{+name/2} %{+name/4} %{+name/3} %{+name/1}' ---|--- **Input**

|

约翰·雅各布·金格尔海默·施密特 **结果**

|

* 姓名 = 施密特，约翰，金格尔海默，雅各布

#### 命名跳过键('？')编辑

剖析支持忽略最终结果中的匹配项。这可以使用空键"%{}"来完成，但为了可读性，可能需要为该空键命名。

命名跳过键修饰符示例

**Pattern**

|

'%{clientip} %{？ident} %{？auth} [%{@timestamp}]' ---|--- **Input**

|

1.2.3.4 - - [30/Apr/1998：22：00：52 +0000] **结果**

|

* clientip = 1.2.3.4 * @timestamp = 30/Apr/1998：22：00：52 +0000

#### 引用键("*"和"&")编辑

使用解析的值作为结构化内容的键/值对来剖析支持。想象一个部分登录键/值对的系统。引用键允许您维护该键/值关系。

引用键修饰符示例

**Pattern**

|

'[%{ts}] [%{level}] %{*p1}：%{&p1} %{*p2}：%{&p2}' ---|--- **Input**

|

[2018-08-10T17：15：42，466][错误] ip：1.2.3.4 错误：拒绝 **结果**

|

* ts = 2018-08-10T17：15：42，466 * 级别 = ERR * IP = 1.2.3.4 * 错误 = 拒绝

« 日期索引名称处理器点扩展处理器 »