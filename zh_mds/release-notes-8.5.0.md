

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Release
notes](es-release-notes.md)

[« Elasticsearch version 8.5.1](release-notes-8.5.1.md) [Elasticsearch
version 8.4.3 »](release-notes-8.4.3.md)

## 弹性搜索版本8.5.0

另请参阅 8.5 中的重大更改。

### 已知问题

* 可能会无意中创建与 V8.5.0 中的索引同名的别名。此操作会使群集处于无效状态，在该状态下，多个功能将无法正常工作，甚至可能无法在此状态下重新启动节点。尽快升级到 8.5.1 以避免发生这种情况的风险 (#91456)。如果您的集群受到此问题的影响，请升级到 8.5.3 进行修复 (#91887)。  * 如果自版本 6.x 以来未修改任何机器学习数据馈送，则无法列出

如果您的数据馈送是在版本 5.x 或 6.x 中创建的，并且自 7.0 版以来未更新，则无法在 8.4 和 8.5 中列出数据馈送。这意味着无法使用 Kibana 管理异常检测作业。此问题已在 8.6.0 中修复。

如果使用此类数据馈送升级到 8.4 或 8.5，则需要通过使用以下步骤更新每个数据馈送的授权信息来解决此问题。

* 使用 'settings.json' 文件配置 Elasticsearch 的编排器可能会在主选举期间遇到死锁(问题：#92812)

要解决死锁，请删除"settings.json"文件并重新启动受影响的节点。

* 当数组中的最后一个元素被过滤掉(例如使用"_source_includes")时解析请求失败。这是由于杰克逊解析器中的一个错误。在 Elasticsearch 8.6.1 中修复 (#91456) * 当使用摄取附件处理器时，Tika 与 log4j 2.18.0 及更高版本(在 Elasticsearch 8.4.0 中引入)的交互会导致过多的日志记录。此日志记录过多，可能导致群集不稳定，直至群集不可用且必须重新启动节点。(问题：#91964)。此问题已在 Elasticsearch 8.7.0 (#93878) 中修复

要解决此问题，请升级到 8.7.0 或更高版本。

### 重大变更

CRUD

    

* 拒绝未知的批量操作 #89450

### 错误修正

Aggregations

    

* 修复"auto_date_histogram">"ip_range"#90317(问题：#90121) * 在"breadth_first"模式下重建记分器且查询上下文已更改时失败 #89993(问题：#37650) * 修复了与空结果 #86939 合并的问题 #86939(问题：#84622) * 修复"ip_prefix"中的部分减少错误 #89734(问题：#89686) * 删除聚合响应 #89467 中意外的元参数(问题：#89455) * 始终允许对大小大于 1 的"top_metrics"聚合进行排序 #89974(问题： #86663) * 分配空存储桶时检查父断路器 #89568(问题：#80789)

Authorization

    

* 删除"__empty"角色的魔术字符串 #89766

CCR

    

* 按原始名称 #90850 对数据流的追随者支持索引进行排序(问题：#90820)

集群协调

    

* 捕获批处理主任务中的弃用警告 #85525(问题：#85506) * 在发送加入请求 #89318 之前检查断路器(问题：#85003)

Distributed

    

* 将"传输群集状态操作"分叉为"管理"线程池 #90996

Engine

    

* 修复"安全"#89248 中的"path.conf".java"拼写错误(问题：#89327)

Geo

    

* 缓冲区 H3Polygon2D 边界框以避免边缘精度问题 #89196(问题：#89868、#87391) * 修复日期直方图范围边缘情况 #88957 * 格式化运行时"geo_points"#85449(问题：#85245) * 如果脚本加载启用了合成"_source"的"_source"，则生成错误 #88334

Graph

    

* 修复超时 #88946 中的竞争条件(问题：#55396)

Health

    

* 修改磁盘指示器详细信息以提供磁盘空间运行状况概述 #90189 * 修复磁盘指示器影响和诊断 #90262 * 修复磁盘指示器 #90869 的详细信息计算 * 报告没有磁盘空间和阻塞索引的影响和诊断数据节点 #90772(问题：#90442) * 将运行状况节点报告的最低版本更新为 8.5 #90365(问题： #90359)

索引接口

    

* 避免捕获每个任务的"翻转结果"#90626(问题：#90620)* 修复了"嵌套"#89351 的分片拆分(问题：#88109)

Infra/Core

    

* 修复特殊情况下的"allow_no_indices"请求选项 #89622 * 修复文件设置服务中重复的错误保存循环 #90271(问题：#90222) * 修复日期数学解析的日期舍入 #90458(问题：#90187) * 修复了在"训练模型分配节点服务"#90972 中禁用"可取消任务"的 APM 跟踪的问题 #90972(问题：#89850) * 支持 7.x 索引上的骆驼案例日期 #88914(问题：#84199)

Infra/Scripting

    

* 修复布尔"源"回退中的真/假累积错误 #90895

采集节点

    

* 仅设置一次扩充维护集群生命周期监听器 #90486

机器学习

    

* 当存在多个可用区时需要正确的层处理器 #90903 * 打开/启动 API 超时时返回 408 而不是 500 #89775(问题：#89585)

Mapping

    

* 修复数值类型中"源"回退的重复错误 #89352 * 在总字段计数中包含运行时字段 #89251(问题：#88265) * 修复"aggregate_metric_double"多值异常 #90290 * 禁用子对象时验证字段名称 #90950

Monitoring

    

* 添加字段以修复 Logstash cgroup 图 #90493

Network

    

* 修复"回收字节流输出"为某些容量分配无限堆 #90632

Recovery

    

* 修复了网络断开连接后过度计算恢复的字节 #90477 (问题： #90441)

Search

    

* 在通配符字段上添加对预定义字符类正则表达式的支持 #90064 * 删除重复的获取文档值字段 #89094 * 不要快捷方式文本字段的总命中计数 #90341(问题：#89760) * 保护"正则表达式"的使用免受"堆栈溢出错误"的影响 #84624(问题：#82923) * 使用 MB 而不是 GB 计算最大布尔子句 #90309(问题：#86136)

Snapshot/Restore

    

* 修复当前快照 API 中失败的分片计数不正确的问题 #89534 * 修复冷/冻结节点上挂载索引的过度分配 #86331 * 修复"快照状态"序列化中的二次复杂性 #90795 * 分叉构建传输线程的快照状态响应 #90651 * 确保在清除文件队列时解析侦听器 #89929 * 重新注册损坏的存储库以取消阻止它 #89719 (问题： #89130) * 拒绝挂载 API 中的未知请求正文字段 #88987(问题：#75982)

TSDS

    

* 修复 TSDS #89754 中的区段统计信息(问题：#89609) * 修复合成"_source"的"GET"请求中的额外字段 #89778 * 修复合成"_source"的"scaled_float"舍入 #88916(问题：#88854)

Transform

    

* 不要使 ClusterBlockException 上的转换失败，这可能是由于 ILM 关闭索引 #90396(问题：#89802) * 修复转换调度中的 NPE#90347(问题：#90356、#88203、#90301、#90255) * 改进状态持久性中的错误处理 #88910(问题：#88905) * 启动 API 超时时返回"408"而不是"500" #89774

矢量搜索

    

* 修复了带有过滤别名的"kNN"的错误 #89621

Watcher

    

* 允许动态设置"xpack.notification.email.account.domain_allowlist" #90426(问题：#89913)* 处理观察程序启动时的超时异常 #90421(问题：#44981)

###Deprecations

Infra/Plugins

    

* 弃用网络插件 #88924 * 弃用覆盖"发现插件"内部 #88925

###Enhancements

Authentication

    

* 为 LDAP 用户模式添加更准确的错误消息 #89492

Authorization

    

* 向企业级搜索服务帐户添加索引权限 #89869 * 在拒绝消息中添加已解析角色的信息 #89680

Autoscaling

    

* 集中处理器配置的概念 #89662

集群协调

    

* 在发布期间抢占式计算"路由节点"和索引查找 #89005 * 抢占式初始化所有节点类型的路由节点和索引查找 #89032

Distributed

    

* 批量索引删除群集状态更新 #90033(问题：#90022)* 将管理池的最小大小增加到"2" #90193

Health

    

* 将 ID 添加到运行状况 API 诊断和影响 #90072 * 当没有主节点且当前节点不符合主节点条件时，向主稳定性运行状况 API 添加检查 #89219 * 向"master_is_stable"指示器添加逻辑以检查发现问题 #88020 * 轮询群集诊断信息 #89014 * 更新 SLM 运行状况诊断消息以包含不正常的策略详细信息 #89138

Highlighting

    

* 提高"边界中断迭代器扫描器"碎片算法的效率 #89041(问题：#73569、#73785)

ILM+SLM

    

* 为缩减采样 ILM 操作添加验证 #90295 * 确保 ILM 不会滚动更新空索引 #89557(问题：#86203) * 在生命周期步骤 #89419 中重复使用信息性消息 * 将与日志相关的逻辑移动到"索引生命周期运行程序"中的日志块中 #89292

Infra/Core

    

* 添加保留的"/_snapshot/repo"基于文件的设置 #89601 * 为队列代理添加"upgrade_status"属性 #89845 * 为基于文件的设置添加对"/_autoscaling/policy"的支持 #89708 * 为基于文件的设置添加对"/_security/role_mapping"的支持 #89667 * 在基于文件的设置中添加对"/_slm/policy"的支持 #89567 * 重试文件监视注册 #90537(问题：#89500)

基础设施/节点生命周期

    

* 区分"节点关闭分配决策程序"#89851 中的无关闭情况(问题：#89823)

Infra/Plugins

    

* 为已弃用的插件 API 添加弃用消息 #88961 * 在"操作模块"中注册稳定插件 #90067 * 加载插件命名组件 #89969

Infra/Scripting

    

* 支持二进制表达式脚本的初始代码 #89895 * 保护更新脚本中的"_source" #88733 * 重新索引和"UpdateByQuery"元数据 #88665 * 添加写入字段 API"嵌套文档"支持 #90021 * 添加写入字段 API 路径操作 #89889 * 添加具有基本路径解析的写入字段 API #89738 * 添加写入字段 API，用于通过查询重新索引、更新和更新 #90145

Infra/Settings

    

* 为磁盘水印阶段引入最大余量 #88639(问题：#81406)

License

    

* 用户配置文件协作功能的许可证检查 #89990

机器学习

    

* 添加非缓存命中推理计数的度量 #90464 * 添加新的"text_similarity"NLP 任务 #88439 * 添加新的训练模型部署缓存清除 API #89074 * 添加处理器自动缩放决策程序 #89645 * 跨可用区分配经过训练的模型分配 #89822 * 使用位集对常用项目进行重复数据删除 #88943 * 优化常用项目事务查找 #89062 * 将原生推理功能发布为 beta 版 #90418 * 启动部署 API 时间时返回"408"出 #89612 * 调用节点关闭 API 后跳过重整化 #89347 * 通过 Gateaux 导数计算异常值特征影响，以改善高维向量的归因 #2256 * 改进具有许多数值特征的数据集的分类和回归模型训练运行时 #2380， #2388， #2390， #2401 * 将训练分类模型的最大类数限制增加到"100" #2395(问题： #2246)

Mapping

    

* 为"aggregate_metric_double"字段添加"synthetic_source"支持 #88909 * 使用操作 #88735 为关键字字段添加"源"回退 * 为"match_only_text"映射类型添加"源"回退支持 #89473 * 为日期和"date_nanos"映射类型添加"源"回退支持 #89440 * 为无符号长映射类型添加"源"回退支持 #89349 * 使用缩放浮点字段类型添加对"源"回退的支持 #89053 * 使用布尔字段添加对"源"回退的支持类型 #89052 * 在无痛脚本字段 API 中添加文本字段支持 API #89396 * 阐明文本字段不支持字段数据错误消息 #89770(问题：#89485) * 为舰队代理"last_checkin_message"和组件字段添加新映射 #89599 * 支持"字节"、"短"和"长"字段的"源"回退 #88954 * 支持"双精度"、"浮点数"的"源"回退， 和"half_float"字段类型 #89010

Network

    

* 对大型 REST 响应使用分块 REST 序列化 #88311

Recovery

    

* 禁用从可搜索快照中的快照恢复 #86388

SQL

    

* 实现"DATE_FORMAT"功能#88388(问题：#55065) * 在不需要时将"track_total_hits"设置为 false#89106(问题：#88764)

Search

    

* 为非数据流索引的"_id"启用"布隆过滤器" #88409 * 在字段功能 API 中，续订对请求正文中的字段的支持 #88972(问题：#86875)

Security

    

* 为用户配置文件添加使用情况统计信息报告 #90123 * 实现用户配置文件激活的宽限期 #89566 * 在 Get/QueryApiKey 响应中返回受限制的角色描述符 #89273 * 在"GetUser"响应中添加返回配置文件 uid 的选项 #89570 * 使用 API 密钥的"获取用户权限"调用返回"400"错误 #89333 * 在 Get/QueryApiKey 响应中显示分配的角色描述符 #89166 * 在"hasPrivileges"响应中添加详细错误 #89224 * 添加对多个 UID 的支持"获取配置文件" API #89023

Snapshot/Restore

    

* 添加对比较"快照进行中"的支持 #89619(问题：#88732) * 分片快照任务优先于文件快照任务，并限制并发运行的快照任务的数量 #88209(问题：#83408)

Stats

    

* 介绍节点映射统计信息 #89807

TSDS

    

* 支持合成"_source"的"match_only_text" #89516 * 支持合成"_source"的直方图字段 #89833 * 支持合成"_source"的版本字段类型 #89706 * 构建"_id"而不重新解析 #88789 * 返回字段上限 API 中的指标字段 API #88695

Transform

    

* 添加无人值守模式设置以转换 #89212

### 新功能

Authorization

    

* 引入新的"read_security"群集权限 #89790(问题：#89245)

Health

    

* 启用运行状况节点和磁盘运行状况指示器 #90085(问题：#84811)

Infra/Core

    

* 使用 OpenTelemetry 和 APM Java 代理提供跟踪实现 #88443(问题：#84369)

Infra/Plugins

    

* 新增稳定版插件 API 模块和分析接口 #88775

机器学习

    

* 使"bucket_correlation"聚合正式发布 #88655 * 使"bucket_count_ks_test"聚合正式发布 #88657

Security

    

* 支持批量更新 API 密钥 #88856

TSDS

    

* 将 TSID 全局序号添加到"TimeSeriesIndexSearcher" #90035 * 发布时间序列数据流功能 #90116(问题：#74660) * 为"关键字"字段上的"ignore_above"参数添加合成的"_source"支持 #89466

矢量搜索

    

* 为"dense_vector"添加合成的"_source"支持 #89840

###Regressions

Infra/Scripting

    

* 修复字段 API 缓存回归 #90017

###Upgrades

Client

    

* 将 Apache Commons Logging 升级到 1.2 #85745(问题：#40305)

Packaging

    

* 将捆绑的 JDK 升级到 Java 19 #90571

[« Elasticsearch version 8.5.1](release-notes-8.5.1.md) [Elasticsearch
version 8.4.3 »](release-notes-8.4.3.md)
