[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[What is
Elasticsearch?](elasticsearch-intro.md)

[« Information out: search and analyze](search-analyze.md) [What's new in
8.9 »](release-highlights.md)

# 可扩展性和弹性：集群、节点和分片

## ElasticSearch的可扩展集群
初构建一个ElasticSearch集群时，数据较少，当随着用户的使用，数据越来越多，如果始终使用一套集群资源，搜索速度将会越来越慢，Elasticsearch是如何解决这个问题的呢？
Elasticsearch 为集群模式，可以在搜索功能始终可用的情况下，根据搜索的需求扩展集群资源，即新部署一台ElasticSearch节点，添加进集群：
* **自然分布**：可以将服务器(节点)添加到集群以增加容量，Elasticsearch 会自动在所有可用节点之间分配数据和查询负载。
* **在线更新**：无需彻底断线应用程序，Elasticsearch 知道如何平衡多节点集群以提供可扩展性和高可用性。
* **集群规模**：集群中节点数量越多，搜索性能越好。

### 这是如何工作的呢？
**索引的分片存储机制：**
在幕后，Elasticsearch 的索引实际上是以一个或多个物理分片的非逻辑分组进行存储，分片实际上是一个具备部分数据的索引。
通过将索引中的文档分布在多个分片上，并将这些分片分布在多个节点上，Elasticsearch 可以确保冗余，既可以防止硬件故障，又可以在将节点添加到集群时增加查询容量。
随着集群的增长(或收缩)，Elasticsearch 会自动迁移分片，重新平衡集群。

分片类型：主分片和副本分片。
* 主分片：索引中的每个文档都属于一个主分片，主分片数量在创建索引时设定的，修改需要重新创建索引。
* 副本分片：主分片的副本（备份），提供数据的冗余副本，以防止出现硬件故障，并增加处理读取请求(如搜索或检索文档)的能力，提高搜索的并发请求数量。副本分片的数量可以随时更改，不会中断索引或查询操作。

## 视情况而定...

在分片大小和为索引配置的主分片数量方面，有许多性能注意事项和权衡。
分片越多，维护这些索引的开销就越大。
分片大小越大，当 Elasticsearch 需要重新平衡集群时，移动分片所需的时间就越长。

查询大量小分片会使每个分片的处理速度更快，但查询越多意味着开销越大，因此查询较少数量的较大分片可能会更快。
总之，索引的主副分片的数量设置，这要看具体使用情况而定。

简单地规则：

* 平均分片大小保持在几 GB 到几十 GB 之间。对于基于时间的数据的使用案例，通常会看到 20GB 到 40GB 范围内的分片。 
* 避免海量分片问题。节点可以容纳的分片数量与可用堆空间成正比。作为一般规则，每 GB 堆空间的分片数应小于 20。

确定用例最佳配置的最佳方法是使用您自己的数据和查询进行测试。

### 发生灾难时，高可用性
集群的节点需要彼此之间良好、可靠的连接。为了提供更好的连接，通常将节点放在同一个数据中心或附近的数据中心。但是，为了保持高可用性，您还需要避免任何单点故障。如果一个位置发生重大中断，另一个位置的服务器需要能够接管。
**跨集群复制 (CCR)**

CCR 提供了一种将索引从主集群自动同步到可用作热备份的辅助远程集群的方法。如果主集群发生故障，辅助集群可以接管。还可以使用 CCR 创建辅助群集，以在地理位置接近的情况下向用户提供读取请求。

跨集群复制是主动-被动的。主集群上的索引是活动领导索引，可处理所有写入请求。复制到辅助集群的索引是只读追随者。

#### 维护

与任何企业系统一样，您需要工具来保护、管理和监控您的 Elasticsearch 集群。集成到 Elasticsearch 中的安全、监控和管理功能使您能够使用 Kibana 作为管理集群的控制中心。数据汇总和索引生命周期管理等功能可帮助您随着时间的推移智能管理数据。

[« Information out: search and analyze](search-analyze.md) [What's new in
8.9 »](release-highlights.md)
