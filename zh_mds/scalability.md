[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[What is
Elasticsearch?](elasticsearch-intro.md)

[« Information out: search and analyze](search-analyze.md) [What's new in
8.9 »](release-highlights.md)

# 可扩展性和弹性:集群、节点和分片
## ElasticSearch的可扩展集群
当我们初次构建一个ElasticSearch集群时,数据量较少。然而,随着用户的增加,数据也会不断增多。如果我们一直使用同一套集群资源,搜索速度将会变得越来越慢。那么,Elasticsearch是如何解决这个问题的呢?

Elasticsearch采用了集群模式,可以根据搜索需求来扩展集群资源,确保搜索功能始终可用。具体做法是通过部署新的ElasticSearch节点并将其添加到集群中:
* **自然分布**:我们可以将服务器(节点)添加到集群中以增加容量。Elasticsearch会自动在所有可用节点之间分配数据和查询负载。
* **在线更新**:无需完全断开应用程序的连接,Elasticsearch可以自动平衡多节点集群,提供可扩展性和高可用性。
* **集群规模**:集群中节点数量越多,搜索性能越好。

### 工作原理是什么?
**索引的分片存储机制:**
实际上,Elasticsearch的索引是以一个或多个物理分片的非逻辑分组进行存储的。每个分片实际上是一个包含部分数据的索引。
通过将索引中的文档分布在多个分片上,并将这些分片分布在多个节点上,Elasticsearch可以确保数据的冗余性,既可以防止硬件故障,又可以在将节点添加到集群时增加查询容量。
随着集群的增长或收缩,Elasticsearch会自动迁移分片,重新平衡集群。

分片分为两种类型:主分片和副本分片。
* **主分片**:索引中的每个文档都属于一个主分片。主分片的数量在创建索引时设定,如果需要修改数量,则需要重新创建索引。
* **副本分片**:主分片的副本(备份),提供数据的冗余副本,以防止硬件故障,并增加处理读取请求(如搜索或检索文档)的能力,提高搜索的并发请求数量。副本分片的数量可以随时更改,不会中断索引或查询操作。

## 如何确定分片的大小和数量

在**确定分片大小**和为索引配置**主分片数量**时,需要考虑许多性能注意事项和权衡。
分片越多,维护这些索引的开销就越大。
分片大小越大,当Elasticsearch需要重新平衡集群时,移动分片所需的时间就越长。

查询大量小分片可以加快每个分片的处理速度,但同时也意味着增加了开销。因此,查询较少数量的较大分片可能会更快。
总之,索引的主副分片数量的设置应根据具体的使用情况而定。

简单的规则如下:

* 分片的平均大小应保持在几GB到几十GB之间。对于基于时间的数据使用案例,通常会使用20GB到40GB范围内的分片。
* 避免创建过多的分片。每个节点可以容纳的分片数量与可用的堆空间成正比。一般来说,每GB堆空间的分片数应小于20。

确定最佳配置的最佳方法是使用数据和查询进行测试。

### 在灾难发生时保持高可用性
集群中的节点需要良好且可靠的连接。为了提供更好的连接,通常会将节点放置在同一个数据中心或附近的数据中心。然而,为了保持高可用性,您还需要避免任何单点故障。如果一个位置发生重大中断,另一个位置的服务器需要能够接管工作。
**跨集群复制 (CCR)**

CCR提供了一种将索引从主集群自动同步到辅助远程集群以用作热备份的方法。如果主集群发生故障,辅助集群可以接管工作。此外,CCR还可以创建辅助群集,以便在地理位置接近的情况下为用户提供读取请求。

跨集群复制是一种主动-被动的机制。主集群上的索引是活动领导索引,负责处理所有写入请求。而复制到辅助集群的索引是只读的追随者。

#### 维护

与任何企业系统一样,您需要工具来保护、管理和监控您的Elasticsearch集群。Elasticsearch集成了安全、监控和管理功能,使您能够使用Kibana作为管理集群的控制中心。通过数据汇总和索引生命周期管理等功能,您可以智能地管理数据随着时间的推移而变化的需求。

[« Information out: search and analyze](search-analyze.md) [What's new in
8.9 »](release-highlights.md)
