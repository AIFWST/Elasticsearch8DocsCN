

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Set up
Elasticsearch](setup.md) ›[Discovery and cluster formation](modules-
discovery.md)

[« Bootstrapping a cluster](modules-discovery-bootstrap-cluster.md) [Cluster
fault detection »](cluster-fault-detection.md)

## 发布集群状态

选定的主节点是集群中唯一可以更改集群状态的节点。选定的主节点一次处理一批集群状态更新，计算所需的更改并将更新的集群状态发布到集群中的所有其他节点。每个发布都从选定的主节点开始，将更新的群集状态广播到群集中的所有节点。每个节点都响应确认，但尚未应用新接收的状态。一旦当选的主节点从足够多的符合主节点条件的节点收集了确认，新的集群状态就被称为 _committed_，并且主集群会广播另一条消息，指示节点应用现在提交的状态。每个节点接收此消息，应用更新的状态，然后将第二个确认发送回主节点。

选定的主节点允许在有限的时间内将每个群集状态更新完全发布到所有节点。它由"cluster.publish.timeout"设置定义，该设置默认为"30s"，从发布开始的时间开始测量。如果在提交新的集群状态之前到达此时间，则集群状态更改将被拒绝，并且当选的主节点认为自己已失败。它停止并开始尝试选择新的主节点。

如果在"cluster.publish.timeout"之前提交新的集群状态，则选定的主节点认为更改已成功。它会等待超时过去或收到群集中每个节点都已应用更新状态的确认，然后开始处理和发布下一个群集状态更新。如果尚未收到某些确认(即某些节点尚未确认它们已应用当前更新)，则称这些节点为_滞后_，因为它们的集群状态已落后于选举主的最新状态。当选的主节点等待滞后节点进一步追赶，即"cluster.follower_lag.timeout"，默认为"90s"。如果节点在此时间内仍未成功应用集群状态更新，则认为该节点已失败，并且当选的主节点将其从集群中删除。

群集状态更新通常作为与上一个群集状态的差异发布，这减少了发布群集状态更新所需的时间和网络带宽。例如，当仅更新处于群集状态的索引子集的映射时，只要这些节点具有以前的群集状态，就只需要将这些索引的更新发布到群集中的节点。如果节点缺少以前的集群状态，例如在重新加入集群时，当选的主节点会将完整集群状态发布到该节点，以便它可以接收未来的更新作为差异。

Elasticsearch是一个基于点对点的系统，其中节点直接相互通信。高吞吐量 API(索引、删除、搜索)通常不与选定的主节点交互。当选主节点的职责是维护全局集群状态，包括在节点加入或离开集群时重新分配分片。每次更改群集状态时，新状态都会发布到群集中的所有节点，如上所述。

群集状态更新的性能特征是每个符合主节点条件的节点上的存储速度以及群集中所有节点之间网络互连的可靠性和延迟的函数。因此，必须确保群集中节点可用的存储和网络足以满足性能目标。

[« Bootstrapping a cluster](modules-discovery-bootstrap-cluster.md) [Cluster
fault detection »](cluster-fault-detection.md)
