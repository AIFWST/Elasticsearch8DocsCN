

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md)
›[Watcher](xpack-alerting.md) ›[Watcher triggers](trigger.md)

[« Watcher triggers](trigger.md) [Watcher conditions »](condition.md)

## 观察程序计划触发器

计划触发器根据日期和时间定义监视执行的开始时间。所有时间均以 UTC 时间指定。

观察程序使用系统时钟来确定当前时间。为了确保在预期时触发计划，应使用时间服务(如 NTP)同步群集中所有节点的时钟。

请记住，油门周期会影响手表的实际执行时间。默认限制周期为 5 秒 (5000 毫秒)。如果配置的计划比限制期更频繁，则限制期将覆盖该计划。例如，如果将限制周期设置为一分钟 (60000 毫秒)，并将计划设置为每 10 秒，则手表每分钟执行不超过一次。有关限制的详细信息，请参阅确认和限制。

观察程序提供多种类型的计划触发器：

* "每小时" * "每天" * "每周" * "每月" * "每年" * "cron" * "间隔"

### 观察者每小时时间表

一天中每小时触发特定一分钟的"计划"。要使用"每小时"计划，请使用"分钟"属性指定希望调度程序启动监视执行的分钟(或分钟)。

如果未为"每小时"计划指定"分钟"属性，则默认为"0"，并且计划每小时触发一次小时 - "12：00"、"13：00"、"14：00"等。

#### 配置每小时一次的计划

要配置每小时一次的计划，请使用"分钟"属性指定单个时间。

例如，以下"每小时"计划在每小时第 30 分钟触发 - "12：30"、"13：30"、"14：30"等：

    
    
    {
      "trigger" : {
        "schedule" : {
          "hourly" : { "minute" : 30 }
        }
      }
    }

#### 配置多次每小时计划

要配置在该小时内多次触发的"每小时"计划，请指定分钟数组。例如，以下计划每小时每 15 分钟触发一次 - "12：00"、"12：15"、"12：30"、"12：45"、"1：00"、"1：15"等：

    
    
    {
      "trigger" : {
        "schedule" : {
          "hourly" : { "minute" : [ 0, 15, 30, 45 ] }
        }
      }
    }

### 观察者每日时间表

每天在特定时间触发的"时间表"。要使用"每日"计划，请使用"at"属性指定希望调度程序启动监视执行的时间。

时间以 24 小时制的"HH：mm"形式指定。您还可以对"00：00"和"12：00"使用保留值"午夜"和"中午"，并使用对象指定时间。

如果未为"每日"计划指定"at"属性，则默认为每天午夜 '00：00' 触发一次。

#### 配置每日计划

要配置每天一次的计划，请使用"at"属性指定一次时间。例如，以下"每日"计划每天下午 5：00 触发一次：

    
    
    {
      "trigger" : {
        "schedule" : {
          "daily" : { "at" : "17:00" }
        }
      }
    }

#### 配置多次每日计划

要配置在一天中多次触发的"每日"计划，请指定一个时间数组。例如，以下"每日"计划每天在"00：00"、"12：00"和"17：00"触发。

    
    
    {
      "trigger" : {
        "schedule" : {
          "daily" : { "at" : [ "midnight", "noon", "17:00" ] }
        }
      }
    }

#### 使用对象指定时间

除了使用"HH：mm"字符串语法指定时间之外，还可以将时间指定为具有"小时"和"分钟"属性的对象。

例如，以下"每日"计划在每天下午 5：00 触发一次：

    
    
    {
      "trigger" : {
        "schedule" : {
          "daily" : {
            "at" : {
              "hour" : 17,
              "minute" : 0
            }
          }
        }
      }
    }

若要使用对象表示法指定多个时间，请将多个小时或分钟指定为数组。例如，遵循"每日"计划触发器每天的"00：00"、"00：30"、"12：00"、"12：30"、"17：00"和"17：30"：

    
    
    {
      "trigger" : {
        "schedule" : {
          "daily" : {
            "at" : {
              "hour" : [ 0, 12, 17 ],
              "minute" : [0, 30]
            }
          }
        }
      }
    }

### 观察者每周时间表

每周在特定日期和时间触发的"时间表"。要使用"每周"计划，请指定希望计划程序使用"on"和"at"属性启动监视执行的日期和时间(或日期和时间)。

您可以按名称、缩写或数字指定星期几(星期日是一周的第一天)：

* "星期日"、"星期一"、"星期二"、"星期三"、"星期四"、"星期五"和"星期六" * "星期日"、"星期一"、"星期二"、"星期三"、"星期四"、"星期五"和"星期六" * "1"、"2"、"3"、"4"、"5"、"6"和"7"

时间以 24 小时制的"HH：mm"形式指定。您还可以将保留值"午夜"和"中午"用于"00：00"和"12：00"。

#### 配置每周计划

要配置每周一次的计划，请使用"on"属性指定日期，使用"at"属性指定时间。例如，以下"每周"计划在星期五下午 5：00 触发一次：

    
    
    {
      "trigger" : {
        "schedule" : {
          "weekly" : { "on" : "friday", "at" : "17:00" }
        }
      }
    }

您还可以使用"天"和"时间"属性指定日期和时间，它们可以与"on"和"at"互换。

#### 配置每周多次计划

要配置每周触发多次的"每周"计划，您可以指定日期和时间值数组。例如，以下"每周"计划在每周二中午 12：00 和每周五下午 5：00 触发：

    
    
    {
      "trigger" : {
        "schedule" : {
          "weekly" : [
            { "on" : "tuesday", "at" : "noon" },
            { "on" : "friday", "at" : "17:00" }
          ]
        }
      }
    }

或者，您可以在具有包含值数组的"on"和"minute"属性的对象中指定日期和时间。例如，以下"每周"计划在每周二和周五中午 12：00 和下午 17：00 触发：

    
    
    {
      "trigger" : {
        "schedule" : {
          "weekly" : {
            "on" : [ "tuesday", "friday" ],
            "at" : [ "noon", "17:00" ]
          }
        }
      }
    }

### 观察者每月计划

每月在特定日期和时间触发的"计划"。要使用"每月"计划，请指定希望计划程序使用"on"和"at"属性启动监视执行的月份中的哪一天和时间(或日期和时间)。

将月份中的某一天指定为介于"1"和"31"(含)之间的数值。时间以 24 小时制的"HH：mm"形式指定。您还可以将保留值"午夜"和"中午"用于"00：00"和"12：00"。

#### 配置月度计划

要配置每月一次的计划，请使用"on"和"at"属性指定单个日期和时间。例如，以下"每月"计划在每个月的 10 号中午触发：

    
    
    {
      "trigger" : {
        "schedule" : {
          "monthly" : { "on" : 10, "at" : "noon" }
        }
      }
    }

您还可以使用"天"和"时间"属性指定日期和时间，它们可以与"on"和"at"互换。

#### 配置每月多次计划

要配置每月触发多次的"每月"计划，您可以指定日期和时间值数组。例如，以下"每月"计划在每个月的 10 日中午 12：00 和每月 20 日的下午 5：00 触发：

    
    
    {
      "trigger" : {
        "schedule" : {
          "monthly" : [
            { "on" : 10, "at" : "noon" },
            { "on" : 20, "at" : "17:00" }
          ]
        }
      }
    }

或者，您可以在具有包含值数组的"on"和"at"属性的对象中指定日期和时间。例如，以下"每月"计划在每个月的 10 日和 20 日上午 12：00 和中午 12：00 触发。

    
    
    {
      "trigger" : {
        "schedule" : {
          "monthly" : {
            "on" : [ 10, 20 ],
            "at" : [ "midnight", "noon" ]
          }
        }
      }
    }

### 观察者年度时间表

每年在特定日期和时间触发的"时间表"。要使用"每年"计划，请指定希望计划程序使用"in"、"on"和"at"属性启动监视执行的月、日和时间(或月、日和时间)。

您可以按名称、缩写或数字指定月份：

* "1月"、"2月"、"3月"、"4月"、"5月"、"6月"、"7月"、"8月"、"9月"、"10月"、"11月"和"12月" * "1月"、"2月"、"3月"、"4月"、"5月"、"6月"、"7月"、"8月"、"9月"、"10月"、"11月"和"12月" * "1"、"2"、"3"、"4"、"5"、"6"、"7"、"8"、"9"、"10"、"11"和"12"

将月份中的某一天指定为介于"1"和"31"(含)之间的数值。时间以 24 小时制的"HH：mm"形式指定。您还可以将保留值"午夜"和"中午"用于"00：00"和"12：00"。

#### 配置年度计划

要配置一年一次的计划，请使用"in"属性指定月份，使用"on"属性指定日期，使用"at"属性指定时间。例如，以下"年度"计划每年在 1 月 10 日中午触发一次：

    
    
    {
      "trigger" : {
        "schedule" : {
          "yearly" : { "in" : "january", "on" : 10, "at" : "noon" }
        }
      }
    }

您还可以使用"月"、"日"和"时间"属性指定月、日和时间，它们可以与"in"、"on"和"at"互换。

#### 配置多次年度计划

若要配置每年触发多次的"年度"计划，可以指定月、日和时间值的数组。例如，以下"年度"计划每年触发两次：1 月 10 日中午和 7 月 20 日下午 5：00。

    
    
    {
      "trigger" : {
        "schedule" : {
          "yearly" : [
            { "in" : "january", "on" : 10, "at" : "noon" },
            { "in" : "july", "on" : 20, "at" : "17:00" }
          ]
        }
      }
    }

或者，您可以在具有包含值数组的"in"、"on"和"minute"属性的对象中指定月、日和时间。例如，以下"年度"计划在 1 月 10 日、1 月 20 日、12 月 10 日和 12 月 20 日的上午 12：00 和中午 12：00 触发。

    
    
    {
      "trigger" : {
        "schedule" : {
          "yearly" : {
            "in" : [ "jan", "dec" ],
            "on" : [ 10, 20 ],
            "at" : [ "midnight", "noon" ]
          }
        }
      }
    }

### Watcher cronschedule

使用 cron 表达式定义一个"计划"，该表达式指定何时执行监视。

虽然 cron 表达式功能强大，但使用其他计划类型更容易配置定期发生的计划。如果必须使用 cron 调度，请确保使用 'elasticsearch-croneval' 进行验证。

#### 一次性配置 cron 调度

要配置"cron"计划，只需将 cron 表达式指定为字符串值即可。例如，以下代码片段配置了每天中午触发的"cron"计划：

    
    
    {
      ...
      "trigger" : {
        "schedule" : {
          "cron" : "0 0 12 * * ?"
        }
      }
      ...
    }

#### 多次配置 cron 调度

要配置多次触发的"cron"计划，您可以指定 cron 表达式数组。例如，以下"cron"调度在工作日每偶数分钟触发一次，在周末每不偶数分钟触发一次：

    
    
    {
      ...
      "trigger" : {
        "schedule" : {
          "cron" : [
            "0 0/2 * ? * MON-FRI",
            "0 1-59/2 * ? * SAT-SUN"
          ]
        }
      }
      ...
    }

#### 使用 croneval 验证 cronexpression

Elasticsearch 在 '$ES_HOME/bin' 目录中提供了一个 'elasticsearch-croneval' 命令行工具，您可以使用它来检查您的 cron 表达式是否有效并产生预期的结果。

要验证 cron 表达式，请将其作为参数传递给 'elasticsearch-croneval'：

    
    
    bin/elasticsearch-croneval "0 0/1 * * * ?"

### 观察程序间隔计划

以固定时间间隔触发的"计划"。间隔可以设置为秒、分钟、小时、天或周：

* "Xs"" \- 每"X"秒触发一次。例如，"30s"表示每 30 秒一次。  * "Xm"" \- 每"X"分钟触发一次。例如，"5m"表示每 5 分钟一次。  * "Xh"" \- 每"X"小时触发一次。例如，"12h"表示每 12 小时一次。  * "Xd"\- 每"X"天触发一次。例如，"3d"表示每 3 天一次。  * "Xw"" \- 每"X"周触发一次。例如，"2w"表示每 2 周一次。

如果未指定时间单位，则默认为秒。

间隔值与 Elasticsearch 中使用的标准_time value_不同。不能以毫秒或纳秒为单位配置间隔。

#### 配置间隔计划

若要配置"间隔"计划，请指定表示间隔的字符串值。如果省略时间单位("s"、"m"、"h"、"d"或"w")，则默认为秒。

例如，以下"间隔"计划每五分钟触发一次：

    
    
    {
      "trigger" : {
        "schedule" : {
          "interval" : "5m"
        }
      }
    }

[« Watcher triggers](trigger.md) [Watcher conditions »](condition.md)
