

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Data
management](data-management.md)

[« Restore a managed data stream or index](index-lifecycle-and-snapshots.md)
[Autoscaling »](xpack-autoscaling.md)

## 数据层

_data tier_是具有相同数据角色的节点集合，这些节点通常共享相同的硬件配置文件：

* 内容层节点处理内容(如产品目录)的索引和查询负载。  * 热层节点处理时序数据(如日志或指标)的索引负载，并保存最新、最常访问的数据。  * 暖层节点保存访问频率较低且很少需要更新的时序数据。  * 冷层节点保存不经常访问且通常不更新的时间序列数据。为了节省空间，可以在冷层上保留可搜索快照的完全装载索引。这些完全装载的索引消除了对副本的需求，与常规索引相比，所需的磁盘空间减少了大约 50%。  * 冻结层节点保存很少访问且从不更新的时间序列数据。冻结层以独占方式存储可搜索快照的部分挂载索引。这进一步扩展了存储容量 — 与暖层相比，存储容量最多增加了 20 倍。

Elasticsearch 通常希望数据层中的节点共享相同的硬件配置文件。不遵循此建议的变体应仔细设计，以避免热点。

将文档直接索引到特定索引时，它们将无限期地保留在内容层节点上。

当您为数据流编制文档索引时，它们最初驻留在热层节点上。您可以将索引生命周期管理 (ILM) 策略配置为根据性能、弹性和数据保留要求自动在热层、温层和冷层之间转换时序数据。

### 内容层

存储在内容层中的数据通常是项目(如产品目录或文章存档)的集合。与时序数据不同，内容的值随着时间的推移保持相对恒定，因此随着时间的流逝，将其移动到具有不同性能特征的层是没有意义的。内容数据通常具有较长的数据保留要求，并且您希望能够快速检索项目，无论其年龄有多大。

内容层节点通常针对查询性能进行优化 - 它们优先考虑处理能力而不是 IO 吞吐量，以便它们可以处理复杂的搜索和聚合并快速返回结果。虽然它们还负责索引，但内容数据的摄取率通常不如日志和指标等时序数据那样高。从复原能力的角度来看，此层中的索引应配置为使用一个或多个副本。

内容层是必需的。不属于数据流的系统索引和其他索引会自动分配给内容层。

### 更热

热层是 Elasticsearch 时间序列数据的入口点，用于保存最新、最常搜索的时间序列数据。更热的节点需要快速读取和写入，这需要更多的硬件资源和更快的存储 (SSD)。为了实现复原能力，应将热层中的索引配置为使用一个或多个副本。

热层是必需的。作为数据流一部分的新索引会自动分配到热层。

### 暖性

时序数据的查询频率低于热层中最近编制索引的数据后，可以移动到暖层。暖层通常保存最近几周的数据。仍然允许更新，但可能不频繁。暖层中的节点通常不需要像热层中的节点一样快。对于复原能力，应将暖层中的索引配置为使用一个或多个副本。

### 冷地

当您不再需要定期搜索时序数据时，它可以从暖层移动到冷层。虽然仍可搜索，但此层通常经过优化，以降低存储成本而不是搜索速度。

为了更好地节省存储，可以在冷层上保留可搜索快照的完全装载索引。与常规索引不同，这些完全挂载的索引不需要副本即可实现可靠性。如果发生故障，他们可以从底层快照中恢复数据。这可能会使数据所需的本地存储减半。需要快照存储库才能在冷层中使用完全挂载的索引。完全挂载的索引是只读的。

或者，可以使用冷层来存储带有副本的常规索引，而不是使用可搜索的快照。这使你可以在较便宜的硬件上存储较旧的数据，但与暖层相比，不会减少所需的磁盘空间。

### 冰雪奇缘

一旦不再查询数据或很少查询数据，它可能会从冷层移动到冻结层，并在余生中保留数据。

冻结层需要快照存储库。冻结层使用部分装载的索引来存储和加载快照存储库中的数据。这降低了本地存储和运营成本，同时仍允许您搜索冻结的数据。由于Elasticsearch有时必须从快照存储库中获取冻结的数据，因此冻结层上的搜索通常比冷层上的搜索慢。

### 在 Elasticsearch Service 或 Elastic CloudEnterprise 上配置数据层

弹性云部署的默认配置包括用于热数据和内容数据的共享层。此层是必需的，无法删除。

若要在创建部署时添加暖层、冷层或冻结层，请执行以下操作：

1. 在"**创建部署**"页上，单击"**高级设置**"。  2. 单击要添加的任何数据层的 **\+ 添加容量**。  3. 单击页面底部的"**创建部署**"以保存更改。

!弹性云的部署 高级配置页面

若要将数据层添加到现有部署，请执行以下操作：

1. 登录弹性云控制台。  2. 在"**部署**"页面上，选择您的部署。  3. 在部署菜单中，选择**编辑**。  4. 单击要添加的任何数据层的 **\+ 添加容量**。  5. 单击页面底部的"**保存**"以保存更改。

若要删除数据层，请参阅禁用数据层。

### 为自我管理部署配置数据层

对于自我管理部署，每个节点的数据角色都在"elasticsearch.yml"中配置。例如，群集中性能最高的节点可能同时分配给热层和内容层：

    
    
    node.roles: ["data_hot", "data_content"]

建议在冻结层中使用专用节点。

### 数据层索引分配

创建索引时，默认情况下，Elasticsearch 会将"index.routing.allocation.include._tier_preference"设置为"data_content"，以自动将索引分片分配给内容层。

当 Elasticsearch 创建索引作为数据流的一部分时，默认情况下 Elasticsearch 将"index.routing.allocation.include._tier_preference"设置为"data_hot"以自动将索引分片分配到热层。

可以显式设置"index.routing.allocation.include._tier_preference"以选择退出默认的基于层的分配。

### 自动数据分层迁移

ILM 通过可用的数据层自动转换托管索引使用迁移操作。默认情况下，此操作在每个阶段自动注入。您可以使用"enabled"： false"显式指定迁移操作以禁用自动迁移，例如，如果您使用分配操作手动指定分配规则。

[« Restore a managed data stream or index](index-lifecycle-and-snapshots.md)
[Autoscaling »](xpack-autoscaling.md)
