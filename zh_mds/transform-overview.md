

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Roll up or
transform your data](data-rollup-transform.md) ›[Transforming
data](transforms.md)

[« Transforming data](transforms.md) [Set up transforms »](transform-
setup.md)

## 转换概述

您可以选择以下任一方法来转换数据：透视或最新。

* 所有转换都保持源索引不变。它们创建一个专用于转换后数据的新索引。  * 与 Kibana 中提供的选项相比，转换可能具有更多 API 提供的配置选项。有关所有转换配置选项，请参阅 API 文档。

转换是持久性任务;它们以群集状态存储，这使它们能够灵活应对节点故障。请参阅检查点的工作原理和错误处理，以了解有关转换背后的机制的更多信息。

### 透视变换

可以使用转换将数据_透视_为新的以实体为中心的索引。通过转换和汇总数据，可以以替代且有趣的方式对其进行可视化和分析。

许多 Elasticsearch 索引被组织成一个事件流：每个事件都是一个单独的文档，例如单个项目购买。转换使您能够汇总此数据，将其转换为更有条理、更易于分析的格式。例如，您可以汇总单个客户的所有购买情况。

转换使您能够定义透视，透视是一组将索引转换为不同的、更易于理解的格式的功能。旋转会在新索引中生成数据摘要。

要定义透视表，请首先选择一个或多个将用于对数据进行分组的字段。您可以选择分类字段(术语)和数值字段进行分组。如果使用数值字段，则使用您指定的间隔对字段值进行存储。

第二步是确定如何聚合分组数据。使用聚合时，您实际上会询问有关索引的问题。有不同类型的聚合，每种聚合都有自己的用途和输出。若要详细了解支持的聚合和分组依据字段，请参阅创建转换。

作为可选步骤，还可以添加查询以进一步限制聚合的范围。

转换执行复合聚合，该聚合对源索引查询定义的所有数据进行分页。聚合的输出存储在_destination index_中。每次转换查询源索引时，它都会创建一个 _checkpoint_。您可以决定是希望转换运行一次还是连续运行。_batch transform_是具有单个检查点的单个操作。_Continuous transforms_引入新的源数据时不断递增和处理检查点。

想象一下，你经营着一家卖衣服的网店。每个订单都会创建一个文档，其中包含唯一的订单ID，订购产品的名称和类别，价格，订购数量，订单的确切日期以及一些客户信息(姓名，性别，位置等)。您的数据集包含去年的所有事务。

如果要检查上一财年不同类别的销售额，请定义一个转换，该转换按产品类别(女鞋、男装等)和订单日期对数据进行分组。使用去年作为订单日期的间隔。然后在订购数量上添加总和聚合。结果是一个以实体为中心的指数，该指数显示去年每个产品类别中的已售商品数量。

!Kibana 中的透视转换预览示例

### 最新转换

可以使用"最新"类型的转换将最新的文档复制到新索引中。您必须将一个或多个字段标识为用于对数据进行分组的唯一键，以及按时间顺序对数据进行排序的日期字段。例如，您可以使用此类型的转换来跟踪每个客户的最新购买或每个主机的最新事件。

!Kibana 中的最新转换预览示例

与透视一样，最新的转换可以运行一次或连续运行。它对源索引中的数据执行复合聚合，并将输出存储在目标索引中。如果转换连续运行，则会自动将 newunique 键值添加到目标索引，并且现有键值的最新文档会在每个检查点自动更新。

### 性能注意事项

转换对源索引执行搜索聚合，然后将结果索引到目标索引中。因此，与聚合和索引过程相比，转换所花费的时间或使用的资源永远不会少。

如果转换必须处理大量历史数据，则它最初具有较高的资源使用率，尤其是在第一个检查点期间。

为了获得更好的性能，请确保搜索聚合和查询已优化，并且转换仅处理必要的数据。考虑是否可以将源查询应用于转换，以缩小转换处理的数据范围。还要考虑群集是否有足够的资源来支持复合聚合搜索和结果索引。

如果您希望分散对集群的影响(以较慢的转换为代价)，则可以限制它执行搜索和索引请求的速率。在创建或更新转换时设置"docs_per_second"限制。如果要计算当前速率，请使用获取转换统计信息 API 中的以下信息：

    
    
    documents_processed / search_time_in_ms * 1000

[« Transforming data](transforms.md) [Set up transforms »](transform-
setup.md)
