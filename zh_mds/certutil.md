

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Command
line tools](commands.md)

[« elasticsearch-certgen](certgen.md) [elasticsearch-create-enrollment-token
»](create-enrollment-token.md)

## elasticsearch-certutil

"elasticsearch-certutil"命令简化了证书的创建，以便在弹性堆栈中与传输层安全性(TLS)一起使用。

###Synopsis

    
    
    bin/elasticsearch-certutil
    (
    (ca [--ca-dn <name>] [--days <n>] [--pem])
    
    | (cert ([--ca <file_path>] | [--ca-cert <file_path> --ca-key <file_path>])
    [--ca-dn <name>] [--ca-pass <password>] [--days <n>]
    [--dns <domain_name>] [--in <input_file>] [--ip <ip_addresses>]
    [--multiple] [--name <file_name>] [--pem] [--self-signed])
    
    | (csr [--dns <domain_name>] [--in <input_file>] [--ip <ip_addresses>]
    [--name <file_name>])
    
    [-E <KeyValuePair>] [--keysize <bits>] [--out <file_path>]
    [--pass <password>]
    )
    
    | http
    
    [-h, --help] ([-s, --silent] | [-v, --verbose])

###Description

您可以指定以下模式之一："ca"、"证书"、"csr"、"http"。'elasticsearch-certutil' 命令还支持静默操作模式，以实现更轻松的批处理操作。

#### CA模式

"ca"模式生成新的证书颁发机构 (CA)。默认情况下，它会生成单个 PKCS#12 输出文件，该文件保存 CA 证书和 CA 的私钥。如果指定"--pem"参数，该命令将生成一个 zip 文件，其中包含 PEM 格式的证书和私钥。

随后，您可以将这些文件用作命令的"证书"模式的输入。

#### 证书模式

"证书"模式生成 X.509 证书和私钥。默认情况下，它会生成单个证书和密钥以用于单个实例。

要为多个实例生成证书和密钥，请指定"--multiple"参数，该参数会提示您输入有关每个实例的详细信息。或者，您可以使用"--in"参数指定包含有关实例的详细信息的 YAML 文件。

实例是需要 TLS 或 SSL 证书的弹性堆栈的任何部分。根据您的配置，Elasticsearch、Logstash、Kibana 和 Beats 可能都需要证书和私钥。实例所需的最低信息是其名称，该名称用作证书的公用名。实例名称可以是主机名值或完整可分辨名称。如果实例名称会导致文件或目录名称无效，则还必须在输入 YAML 文件的"--name"命令参数或"文件名"字段中指定文件名。

您可以选择为每个实例提供 IP 地址或 DNS 名称。如果未指定 IP 地址和 DNS 名称，则 Elastic Stack 产品无法执行主机名验证，您可能需要将"verification_mode"安全设置配置为"证书"。有关此设置的详细信息，请参阅安全设置。

此命令生成的所有证书都由 CA 签名，除非指定了"--self-signed"参数。您必须为自己的 CA 提供"--ca"或"--ca-cert"和"--ca-key"参数，除非指定了"--自签名"。有关生成 CA 的详细信息，请参阅此命令的 CA 模式。要生成自签名证书，请使用"--自签名"参数。

默认情况下，"证书"模式生成单个 PKCS#12 输出文件，其中包含实例证书、实例私钥和 CA 证书。如果指定"--pem"参数，则该命令将生成 PEM 格式的证书和密钥，并将它们打包到 zip 文件中。如果指定"--multiple"或"--in"参数，该命令将生成一个包含生成的证书和密钥的 zip 文件。

#### 企业社会责任模式

"csr"模式生成证书签名请求 (CSR)，您可以将这些请求发送到受信任的证书颁发机构以获取签名证书。签名证书必须采用 PEM 或 PKCS#12 格式才能使用 Elasticsearchsecurity 功能。

默认情况下，该命令为单个实例生成单个 CSR。

要为多个实例生成 CSR，请指定"--multiple"参数，该参数会提示您输入每个实例的详细信息。或者，您可以使用"--in"参数指定包含有关实例的详细信息的 YAML 文件。

"csr"模式生成一个 zip 文件，其中包含每个实例的 CSR 和私钥。每个 CSR 都作为 PKCS#10 CSR 的标准 PEMencoding 提供。每个密钥都作为 RSA 私钥的 PEM 编码提供。

#### HTTPmode

"http"模式将引导您完成在 HTTP (REST) 接口上为 Elasticsearch 生成证书的过程。它会询问您许多问题，以便根据您的需求生成正确的文件集。例如，根据您的选择，它可能会生成一个 zip 文件，其中包含证书颁发机构 (CA)、证书签名请求 (CSR) 或用于 Elasticsearch 和 Kibana 的证书和密钥。zip 文件中的每个文件夹都包含一个自述文件，说明如何使用这些文件。

###Parameters

`ca`

     Specifies to generate a new local certificate authority (CA). This parameter cannot be used with the `csr`, `cert` or `http` parameters. 
`cert`

     Specifies to generate new X.509 certificates and keys. This parameter cannot be used with the `csr`, `ca` or `http` parameters. 
`csr`

     Specifies to generate certificate signing requests. This parameter cannot be used with the `ca`, `cert` or `http` parameters. 
`http`

     Generates a new certificate or certificate request for the Elasticsearch HTTP interface. This parameter cannot be used with the `ca`, `cert` or `csr` parameters. 
`--ca <file_path>`

     Specifies the path to an existing CA key pair (in PKCS#12 format). This parameter is only applicable to the `cert` parameter. 
`--ca-cert <file_path>`

     Specifies the path to an existing CA certificate (in PEM format). You must also specify the `--ca-key` parameter. The `--ca-cert` parameter is only applicable to the `cert` parameter. 
`--ca-dn <name>`

     Defines the _Distinguished Name_ (DN) that is used for the generated CA certificate. The default value is `CN=Elastic Certificate Tool Autogenerated CA`. This parameter cannot be used with the `csr` or `http` parameters. 
`--ca-key <file_path>`

     Specifies the path to an existing CA private key (in PEM format). You must also specify the `--ca-cert` parameter. The `--ca-key` parameter is only applicable to the `cert` parameter. 
`--ca-pass <password>`

     Specifies the password for an existing CA private key or the generated CA private key. This parameter is only applicable to the `cert` parameter 
`--days <n>`

     Specifies an integer value that represents the number of days the generated certificates are valid. The default value is `1095`. This parameter cannot be used with the `csr` or `http` parameters. 
`--dns <domain_name>`

     Specifies a comma-separated list of DNS names. This parameter cannot be used with the `ca` or `http` parameters. 
`-E <KeyValuePair>`

     Configures a setting. 
`-h, --help`

     Returns all of the command parameters. 
`--in <input_file>`

     Specifies the file that is used to run in silent mode. The input file must be a YAML file. This parameter cannot be used with the `ca` or `http` parameters. 
`--ip <IP_addresses>`

     Specifies a comma-separated list of IP addresses. This parameter cannot be used with the `ca` or `http` parameters. 
`--keysize <bits>`

     Defines the number of bits that are used in generated RSA keys. The default value is `2048`. This parameter cannot be used with the `http` parameter. 
`--multiple`

     Specifies to generate files for multiple instances. This parameter cannot be used with the `ca` or `http` parameters. 
`--name <file_name>`

     Specifies the name of the generated certificate. This parameter cannot be used with the `ca` or `http` parameters. 
`--out <file_path>`

     Specifies a path for the output files. This parameter cannot be used with the `http` parameter. 
`--pass <password>`

    

指定生成的私钥的密码。此参数不能与"http"参数一起使用。

以 PKCS#12 格式存储的密钥始终受密码保护，但是，此密码可能为 _blank_。如果要指定一个空白密码而不提示，请在命令行上使用"--pass ""(不带"=")。

仅当指定了"--pass"参数时，以 PEM 格式存储的密钥才受密码保护。如果未提供"--pass"参数的参数，系统将提示您输入密码。加密的 PEM 文件不支持空白密码(如果您不希望对 PEM 密钥进行密码保护，则不要指定"--pass")。

`--pem`

     Generates certificates and keys in PEM format instead of PKCS#12. This parameter cannot be used with the `csr` or `http` parameters. 
`--self-signed`

    

生成自签名证书。此参数仅适用于"证书"参数。

不建议在群集上设置 TLS 时使用此选项。事实上，只有当您确定绝对不需要 CA 并且信任直接授予证书本身时，才应使用自签名证书。

'-s， --沉默'

     Shows minimal output. 
`-v, --verbose`

     Shows verbose output. 

###Examples

以下命令生成 PKCS#12 格式的 CA 证书和私钥：

    
    
    bin/elasticsearch-certutil ca

系统将提示您输入输出文件名和密码。或者，您可以指定"--out"和"--pass"参数。

然后，可以使用新 CA 生成 X.509 证书和私钥。例如：

    
    
    bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12

系统将提示您输入 CA 密码以及输出文件名和密码。或者，您可以指定"--ca-pass"、"--out"和"--pass"参数。

默认情况下，此命令会生成一个名为 'elastic-certificate.p12' 的文件，您可以将其复制到要配置的每个 Elasticproduct 的相关配置目录中。有关更多信息，请参阅使用 TLS 加密节点间通信。

#### 在静默模式下使用 'elasticsearch-certutil'

要使用静默操作模式，您必须创建一个包含有关实例信息的 YAML 文件。它必须与以下格式匹配：

    
    
    instances:
      - name: "node1" __ip: __- "192.0.2.1"
        dns: __- "node1.mydomain.com"
      - name: "node2"
        ip:
          - "192.0.2.2"
          - "198.51.100.1"
      - name: "node3"
      - name: "node4"
        dns:
          - "node4.mydomain.com"
          - "node4.internal"
      - name: "CN=node5,OU=IT,DC=mydomain,DC=com"
        filename: "node5" __

__

|

实例的名称。这可以是简单的字符串值，也可以是可分辨名称 (DN)。这是唯一的必填字段。   ---|---    __

|

表示此实例的 IP 地址的可选字符串数组。允许使用 IPv4 和 IPv6 值。这些值将添加为主题备用名称。   __

|

表示此实例的 DNS 名称的可选字符串数组。这些值将添加为主题备用名称。   __

|

要用于此实例的文件名。此名称用作输出中包含实例文件的目录的名称。它还用于目录中文件的名称中。此文件名不应具有扩展名。注意：如果为实例提供的"名称"不代表有效的文件名，则必须存在"文件名"字段。   当您的 YAML 文件准备就绪时，您可以使用 'elasticsearch-certutil' 命令来生成证书或证书签名请求。只需使用 '--in' 参数指定文件的位置。例如：

    
    
    bin/elasticsearch-certutil cert --silent --in instances.yml --out test1.zip --pass testpassword --ca elastic-stack-ca.p12

此命令生成压缩的"test1.zip"文件。解压缩输出文件后，"instances.yml"文件中列出的每个实例都有一个目录。每个实例目录都包含一个 PKCS#12('.p12') 文件，其中包含实例证书、实例私钥和 CA 证书。

还可以使用 YAML 文件生成证书签名请求。例如：

    
    
    bin/elasticsearch-certutil csr --silent --in instances.yml --out test2.zip --pass testpassword

此命令生成一个压缩文件，其中包含每个实例的目录。每个实例目录都包含一个证书签名请求("*.csr"文件)和私钥("*.key"文件)。

[« elasticsearch-certgen](certgen.md) [elasticsearch-create-enrollment-token
»](create-enrollment-token.md)
