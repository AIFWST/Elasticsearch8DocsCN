

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Monitor a
cluster](monitor-elasticsearch-cluster.md) ›[Collecting monitoring data
using legacy collectors](collecting-monitoring-data.md)

[« Exporters](es-monitoring-exporters.md) [HTTP exporters »](http-
exporter.md)

## 本地导出器

Elastic 代理和 Metricbeat 是收集监控数据并将其传送到监控集群的推荐方法。

如果您之前配置了旧版收集方法，则应迁移到使用 Elastic Agent 或 Metricbeat 收集。不要将旧收集与其他收集方法一起使用。

"本地"导出器是 X-Pack 监控中的默认导出器。它将数据路由回同一(本地)集群。换句话说，它使用生产集群作为监控集群。例如：

    
    
    xpack.monitoring.exporters.my_local_exporter: __type: local

__

|

导出器名称唯一定义导出器，但在其他方面未使用。   ---|--- 此导出器的存在是为了在硬件根本不可用时提供方便的选项。这也是开发人员了解他们的操作在没有时间或资源来提供单独的监视集群时对预生产集群做什么的一种方式。但是，此导出器具有影响本地群集的缺点：

* 所有索引都会影响本地集群和保存监控索引分片的节点。  * 大多数收集器在选定的主节点上运行。因此，大多数索引都是以选定的主节点作为协调节点进行的，这是一种不好的做法。  * 任何使用 X-Pack 监控 Kibana 的方法都会使用本地集群的资源进行搜索和聚合，这意味着它们可能无法用于非监控任务。  * 如果本地集群出现故障，则监控集群本身也随之关闭(反之亦然)，这通常会违背监控的目的。

对于"本地"导出器，所有设置仅在选定的主节点上进行。这意味着，如果您没有看到任何监控模板或摄取管道，则所选主节点出现问题或配置方式不同。与"http"导出器不同，"本地"导出器具有访问监控集群的最新集群状态的优势。因此，它始终可以检查模板和引入管道是否存在，而不会降低性能。如果选定的主节点在尝试创建监控资源时遇到错误，它将记录错误，忽略该集合，并在下一次收集后重试。

选定的主节点是为"本地"导出器设置资源的唯一节点。因此，所有其他节点在为来自其自己的收集器的任何监视数据编制索引之前，都会等待资源设置完毕。其中每个节点都会记录一条消息，指示它们正在等待设置资源。

"本地"导出器的一个好处是它位于集群内，因此当集群使用 Elastic Stack 安全功能进行保护时，不需要额外的配置。来自"本地"导出器的所有操作，包括索引操作，都利用了 Elasticsearch 中的内部传输机制。此行为使导出器能够在启用安全功能时无需提供任何用户凭据即可使用。

有关"本地"导出器的配置选项的详细信息，请参阅本地导出器设置。

### 清洁服务

"本地"导出器的一个功能("http"导出器中不存在)是更干净的服务。清理器服务每天在选定的主节点上凌晨 01：00 UTC 运行一次。

清理器服务的作用是清理或管理早于可配置时间量的监视索引(默认值为"7d")。这种清洁剂作为"本地"出口商的一部分作为安全机制存在。"http"导出器不会使用它，因为它可能会使单个错误配置的节点过早地管理来自共享同一监视群集的其他生产群集的数据。

在专用监控集群中，您可以使用清理器服务，而无需监控监控集群本身。例如：

    
    
    xpack.monitoring.collection.enabled: false __xpack.monitoring.history.duration: 3d __

__

|

禁用监控集群上的数据收集。   ---|---    __

|

将默认历史记录持续时间从"7d"降低到"3d"。最小值为"1d"。此设置只能在使用黄金或更高级别许可证时修改。对于基本许可证级别，它使用默认值 7 天。   要禁用清理器服务，请添加已禁用的本地导出器：

    
    
    xpack.monitoring.exporters.my_local.type: local __xpack.monitoring.exporters.my_local.enabled: false __

__

|

添加名为"my_local"的本地导出器 ---|--- __

|

禁用本地导出器。这也会禁用清洁服务。   « 导出器 HTTP 导出器 »