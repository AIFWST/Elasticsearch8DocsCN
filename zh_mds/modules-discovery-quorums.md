

[Elastic Docs](/guide/) ›[Elasticsearch Guide [8.9]](index.md) ›[Set up
Elasticsearch](setup.md) ›[Discovery and cluster formation](modules-
discovery.md)

[« Discovery](discovery-hosts-providers.md) [Voting configurations
»](modules-discovery-voting.md)

## 基于仲裁的决策

选择主节点和更改群集状态是符合主节点条件的节点必须协同执行的两个基本任务。即使某些节点发生故障，这些活动也必须可靠运行，这一点很重要。Elasticsearch 通过考虑每个操作在收到来自 _quorum_ 的响应时都成功来实现这种健壮性，_quorum_ 是集群中符合主节点条件的子集。只需要一部分节点进行响应的好处是，这意味着某些节点可能会失败，而不会阻止群集取得进展。仲裁是经过精心选择的，因此群集没有"裂脑"方案，在这种方案中，群集被划分为两个部分，以便每个部分都可能做出与另一个部分不一致的决策。

Elasticsearch 允许您在正在运行的集群中添加和删除符合主节点条件的节点。在许多情况下，您只需根据需要启动或停止节点即可完成此操作。请参阅_Add和删除cluster_中的节点。

添加或删除节点时，Elasticsearch 通过更新集群的投票配置来保持最佳容错级别，投票配置是一组符合主节点条件的节点，在做出选择新主节点或提交新集群状态等决策时，将计算其响应。只有在投票配置中超过一半的节点做出响应后，才会做出决定。通常，投票配置与群集中当前所有符合主节点条件的节点集相同。但是，在某些情况下，它们可能会有所不同。

为了确保集群保持可用，您**不得同时停止投票配置中的一半或更多节点**。只要超过一半的投票节点可用，集群仍然可以正常工作。这意味着，如果有三个或四个符合主节点条件的节点，则集群可以容忍其中一个节点不可用。如果有两个或更少的主节点，则它们必须全部保持可用。

节点加入或离开集群后，当选的主节点必须发出集群状态更新，以调整投票配置以匹配，这可能需要很短的时间才能完成。请务必等待此调整完成，然后再从群集中删除更多节点。

#### 主选

Elasticsearch 使用选举过程来就选定的主节点达成一致，无论是在启动时还是在现有的选定主节点失败时。任何符合主节点资格的节点都可以开始选举，通常第一次选举会成功。只有当两个节点碰巧同时开始选举时，选举通常才会失败，因此在每个节点上随机安排选举以减少发生这种情况的可能性。节点将重试选择，直到选择主节点，在失败时退出，以便最终选举成功(概率任意高)。主选举的安排由主选举设置控制。

#### 集群维护、滚动重启和迁移

许多群集维护任务涉及暂时关闭一个或多个节点，然后重新启动它们。默认情况下，如果 Elasticsearch 的某个符合主节点条件的节点脱机(例如在滚动升级期间)，Elasticsearch 仍可用。此外，如果多个节点停止然后再次启动，则它将自动恢复，例如在完整群集重新启动期间。在这些情况下，无需对此处所述的 API 执行任何进一步操作，因为主节点集不会永久更改。

[« Discovery](discovery-hosts-providers.md) [Voting configurations
»](modules-discovery-voting.md)
